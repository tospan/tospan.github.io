<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Unity GPP Command Pattern | 吐司片的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="What’s the command pattern?We begin with Wikipedia‘s defintion of the command pattern:

In object-oriented programming, the command pattern is a behavioral design pattern in which an object is used to">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity GPP Command Pattern">
<meta property="og:url" content="http://tospan.me/2017/02/05/GDP-Command-Pattern/index.html">
<meta property="og:site_name" content="吐司片的博客">
<meta property="og:description" content="What’s the command pattern?We begin with Wikipedia‘s defintion of the command pattern:

In object-oriented programming, the command pattern is a behavioral design pattern in which an object is used to">
<meta property="og:updated_time" content="2017-02-05T07:07:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity GPP Command Pattern">
<meta name="twitter:description" content="What’s the command pattern?We begin with Wikipedia‘s defintion of the command pattern:

In object-oriented programming, the command pattern is a behavioral design pattern in which an object is used to">
  
    <link rel="alternate" href="/atom.xml" title="吐司片的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">吐司片的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Work hard, play hard.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://tospan.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-GDP-Command-Pattern" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/05/GDP-Command-Pattern/" class="article-date">
  <time datetime="2017-02-05T07:07:34.000Z" itemprop="datePublished">2017-02-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity/">Unity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Unity GPP Command Pattern
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="What’s-the-command-pattern"><a href="#What’s-the-command-pattern" class="headerlink" title="What’s the command pattern?"></a>What’s the command pattern?</h2><p>We begin with <a href="https://en.wikipedia.org/wiki/Command_pattern" target="_blank" rel="external">Wikipedia</a>‘s defintion of the command pattern:</p>
<blockquote>
<p>In object-oriented programming, the command pattern is a behavioral design pattern in which an object is used to encapsulate all information needed to perform an action or trigger an event at a later time. This information includes the method name, the object that owns the method and values for the method parameters.</p>
</blockquote>
<a id="more"></a>
<p>…and according to the author of the book Game Programming Patterns, the command pattern is one of his favorite patterns, and he’s often using it somewhere in most large programs he has written.</p>
<p>One example where the command pattern is really useful is when you let the users of your game change the keys. In Unity, you can write a simple fire function like this:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (Input.GetKeyDown(KeyCode.A))</div><div class="line">&#123;</div><div class="line">	FireWeapon();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>So what are you going to do if the user would like to fire the weapon with U and not A? To make that happen we have to find a way to replace FireWeapon(); with something more general, and that’s why we need the command pattern. We begin by defining a base/parent class called Command:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Command</span></div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params"></span>)</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>…and then the FireWeapon will inherit from that base class. We also need a class that will do nothing, so we can switch to U from A when firing the weapon.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FireWeapon</span> : <span class="title">Command</span></div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params"></span>)</span></div><div class="line">	&#123;</div><div class="line">		FireTheWeapon();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DoNothing</span> : <span class="title">Command</span></div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params"></span>)</span></div><div class="line">	&#123;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Where we earlier was just firing the weapon when pressing A, we can now easily replace FireWeapon(); with the more general Execute(); when we press the U key. So you have to come up with a clever GUI so your user can replace buttonA with buttonU, but that will be much easier than using the FireWeapon(); when pressing a certain key.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Command buttonU = <span class="keyword">new</span> FireWeapon();</div><div class="line">Command buttonA = <span class="keyword">new</span> DoNothing();</div><div class="line"></div><div class="line"><span class="keyword">if</span> (Input.GetKeyDown(KeyCode.U))</div><div class="line">&#123;</div><div class="line">	buttonU.Execute(); <span class="comment">//Will now call the FireTheWeapon() method in the Execute() method in the FireWeapon class </span></div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (Input.GetKeyDown(KeyCode.A))</div><div class="line">&#123;</div><div class="line">	buttonA.Execute(); <span class="comment">//Will do nothing because the Execute() method in DoNothing class is empty</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>But that’s not it! If you are saving the commands you are sending in a list, you will also be able to undo the commands. Let’s say you have a level editor and are placing trees. Then you can use the command pattern to undo the last (or all) commands in the case you placed the tree at the wrong spot.</p>
<p>By using the same list as when undoing something you will also be able to make a replay function. If you remember the start positions, then you just loop over the commands you have saved and Unity will reproduce everything you did. This is a much better way than saving the position and orientation of all your objects in the scene each frame and then repeat the positions while looping the list. Or as the author of the book said:</p>
<blockquote>
<p>Many games record the set of commands every entity performed each frame. To replay the game, the engine just runs the normal game simulation, executing pre-recorded commands.</p>
</blockquote>
<h2 id="The-command-pattern-in-Unity"><a href="#The-command-pattern-in-Unity" class="headerlink" title="The command pattern in Unity"></a>The command pattern in Unity</h2><p>The idea behind these scripts is that you have a gameobject, like a box, and then you can move the box with WASD. But thanks to the command pattern you will also be able to undo movements with Z key and replay all movements from the beginning with the R key.</p>
<p>What you need is a scene with a box and an empty gameobject. Add the script InputHandler.cs to the empty gameobject and drag the box to the script. That’s it!</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.Collections.Generic;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">CommandPattern</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InputHandler</span> : <span class="title">MonoBehaviour</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//The box we control with keys</span></div><div class="line">        <span class="keyword">public</span> Transform boxTrans;</div><div class="line">        <span class="comment">//The different keys we need</span></div><div class="line">        <span class="keyword">private</span> Command buttonW, buttonS, buttonA, buttonD, buttonB, buttonZ, buttonR;</div><div class="line">        <span class="comment">//Stores all commands for replay and undo</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Command&gt; oldCommands = <span class="keyword">new</span> List&lt;Command&gt;();</div><div class="line">        <span class="comment">//Box start position to know where replay begins</span></div><div class="line">        <span class="keyword">private</span> Vector3 boxStartPos;</div><div class="line">        <span class="comment">//To reset the coroutine</span></div><div class="line">        <span class="keyword">private</span> Coroutine replayCoroutine;</div><div class="line">        <span class="comment">//If we should start the replay</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> shouldStartReplay;</div><div class="line">        <span class="comment">//So we cant press keys while replaying</span></div><div class="line">        <span class="keyword">private</span> <span class="keyword">bool</span> isReplaying;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="comment">//Bind keys with commands</span></div><div class="line">            buttonB = <span class="keyword">new</span> DoNothing();</div><div class="line">            buttonW = <span class="keyword">new</span> MoveForward();</div><div class="line">            buttonS = <span class="keyword">new</span> MoveReverse();</div><div class="line">            buttonA = <span class="keyword">new</span> MoveLeft();</div><div class="line">            buttonD = <span class="keyword">new</span> MoveRight();</div><div class="line">            buttonZ = <span class="keyword">new</span> UndoCommand();</div><div class="line">            buttonR = <span class="keyword">new</span> ReplayCommand();</div><div class="line"></div><div class="line">            boxStartPos = boxTrans.position;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (!isReplaying)</div><div class="line">            &#123;</div><div class="line">                HandleInput();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            StartReplay();</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//Check if we press a key, if so do what the key is binded to </span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleInput</span>(<span class="params"></span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.A))</div><div class="line">            &#123;</div><div class="line">                buttonA.Execute(boxTrans, buttonA);</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">Input.GetKeyDown(KeyCode.B</span>))</span></div><div class="line">            &#123;</div><div class="line">                buttonB.Execute(boxTrans, buttonB);</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">Input.GetKeyDown(KeyCode.D</span>))</span></div><div class="line">            &#123;</div><div class="line">                buttonD.Execute(boxTrans, buttonD);</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">Input.GetKeyDown(KeyCode.R</span>))</span></div><div class="line">            &#123;</div><div class="line">                buttonR.Execute(boxTrans, buttonZ);</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">Input.GetKeyDown(KeyCode.S</span>))</span></div><div class="line">            &#123;</div><div class="line">                buttonS.Execute(boxTrans, buttonS);</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">Input.GetKeyDown(KeyCode.W</span>))</span></div><div class="line">            &#123;</div><div class="line">                buttonW.Execute(boxTrans, buttonW);</div><div class="line">            &#125;</div><div class="line">            <span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">Input.GetKeyDown(KeyCode.Z</span>))</span></div><div class="line">            &#123;</div><div class="line">                buttonZ.Execute(boxTrans, buttonZ);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//Checks if we should start the replay</span></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">StartReplay</span>(<span class="params"></span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (shouldStartReplay &amp;&amp; oldCommands.Count &gt; <span class="number">0</span>)</div><div class="line">            &#123;</div><div class="line">                shouldStartReplay = <span class="literal">false</span>;</div><div class="line"></div><div class="line">                <span class="comment">//Stop the coroutine so it starts from the beginning</span></div><div class="line">                <span class="keyword">if</span> (replayCoroutine != <span class="literal">null</span>)</div><div class="line">                &#123;</div><div class="line">                    StopCoroutine(replayCoroutine);</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="comment">//Start the replay</span></div><div class="line">                replayCoroutine = StartCoroutine(ReplayCommands(boxTrans));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//The replay coroutine</span></div><div class="line">        <span class="function">IEnumerator <span class="title">ReplayCommands</span>(<span class="params">Transform boxTrans</span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="comment">//So we can't move the box with keys while replaying</span></div><div class="line">            isReplaying = <span class="literal">true</span>;</div><div class="line">            </div><div class="line">            <span class="comment">//Move the box to the start position</span></div><div class="line">            boxTrans.position = boxStartPos;</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; oldCommands.Count; i++)</div><div class="line">            &#123;</div><div class="line">                <span class="comment">//Move the box with the current command</span></div><div class="line">                oldCommands[i].Move(boxTrans);</div><div class="line"></div><div class="line">                <span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">0.3</span>f</span>)</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">//We can move the box again</span></div><div class="line">            isReplaying = <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This script has collected all the commands we need. You should probably have one class per script when you are making your own command pattern.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> System.Collections.Generic;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">CommandPattern</span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//The parent class</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Command</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//How far should the box move when we press a button</span></div><div class="line">        <span class="keyword">protected</span> <span class="keyword">float</span> moveDistance = <span class="number">1</span>f;</div><div class="line"></div><div class="line">        <span class="comment">//Move and maybe save command</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">Transform boxTrans, Command command</span>)</span>;</div><div class="line"></div><div class="line">        <span class="comment">//Undo an old command</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Undo</span>(<span class="params">Transform boxTrans</span>) </span>&#123; &#125;</div><div class="line"></div><div class="line">        <span class="comment">//Move the box</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Transform boxTrans</span>) </span>&#123; &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">// Child classes</span></div><div class="line">    <span class="comment">//</span></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveForward</span> : <span class="title">Command</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//Called when we press a key</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">Transform boxTrans, Command command</span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="comment">//Move the box</span></div><div class="line">            Move(boxTrans);</div><div class="line">            </div><div class="line">            <span class="comment">//Save the command</span></div><div class="line">            InputHandler.oldCommands.Add(command);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//Undo an old command</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Undo</span>(<span class="params">Transform boxTrans</span>)</span></div><div class="line">        &#123;</div><div class="line">            boxTrans.Translate(-boxTrans.forward * moveDistance);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//Move the box</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Transform boxTrans</span>)</span></div><div class="line">        &#123;</div><div class="line">            boxTrans.Translate(boxTrans.forward * moveDistance);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveReverse</span> : <span class="title">Command</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//Called when we press a key</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">Transform boxTrans, Command command</span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="comment">//Move the box</span></div><div class="line">            Move(boxTrans);</div><div class="line"></div><div class="line">            <span class="comment">//Save the command</span></div><div class="line">            InputHandler.oldCommands.Add(command);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//Undo an old command</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Undo</span>(<span class="params">Transform boxTrans</span>)</span></div><div class="line">        &#123;</div><div class="line">            boxTrans.Translate(boxTrans.forward * moveDistance);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//Move the box</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Transform boxTrans</span>)</span></div><div class="line">        &#123;</div><div class="line">            boxTrans.Translate(-boxTrans.forward * moveDistance);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveLeft</span> : <span class="title">Command</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//Called when we press a key</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">Transform boxTrans, Command command</span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="comment">//Move the box</span></div><div class="line">            Move(boxTrans);</div><div class="line"></div><div class="line">            <span class="comment">//Save the command</span></div><div class="line">            InputHandler.oldCommands.Add(command);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//Undo an old command</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Undo</span>(<span class="params">Transform boxTrans</span>)</span></div><div class="line">        &#123;</div><div class="line">            boxTrans.Translate(boxTrans.right * moveDistance);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//Move the box</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Transform boxTrans</span>)</span></div><div class="line">        &#123;</div><div class="line">            boxTrans.Translate(-boxTrans.right * moveDistance);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveRight</span> : <span class="title">Command</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//Called when we press a key</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">Transform boxTrans, Command command</span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="comment">//Move the box</span></div><div class="line">            Move(boxTrans);</div><div class="line"></div><div class="line">            <span class="comment">//Save the command</span></div><div class="line">            InputHandler.oldCommands.Add(command);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//Undo an old command</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Undo</span>(<span class="params">Transform boxTrans</span>)</span></div><div class="line">        &#123;</div><div class="line">            boxTrans.Translate(-boxTrans.right * moveDistance);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//Move the box</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Transform boxTrans</span>)</span></div><div class="line">        &#123;</div><div class="line">            boxTrans.Translate(boxTrans.right * moveDistance);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//For keys with no binding</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DoNothing</span> : <span class="title">Command</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//Called when we press a key</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">Transform boxTrans, Command command</span>)</span></div><div class="line">        &#123;</div><div class="line">            <span class="comment">//Nothing will happen if we press this key</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//Undo one command</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UndoCommand</span> : <span class="title">Command</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//Called when we press a key</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">Transform boxTrans, Command command</span>)</span></div><div class="line">        &#123;</div><div class="line">            List&lt;Command&gt; oldCommands = InputHandler.oldCommands;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (oldCommands.Count &gt; <span class="number">0</span>)</div><div class="line">            &#123;</div><div class="line">                Command latestCommand = oldCommands[oldCommands.Count - <span class="number">1</span>];</div><div class="line"></div><div class="line">                <span class="comment">//Move the box with this command</span></div><div class="line">                latestCommand.Undo(boxTrans);</div><div class="line"></div><div class="line">                <span class="comment">//Remove the command from the list</span></div><div class="line">                oldCommands.RemoveAt(oldCommands.Count - <span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//Replay all commands</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ReplayCommand</span> : <span class="title">Command</span></div><div class="line">    &#123;</div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Execute</span>(<span class="params">Transform boxTrans, Command command</span>)</span></div><div class="line">        &#123;</div><div class="line">            InputHandler.shouldStartReplay = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tospan.me/2017/02/05/GDP-Command-Pattern/" data-id="cizcq855h001atdvwkiy6irco" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity/">Unity</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/02/05/GDP-Flyweight-Pattern/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Unity游戏编程模式:Flyweight Pattern
        
      </div>
    </a>
  
  
    <a href="/2017/02/05/Unity-Dynamic-Mesh-Combining/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Unity Dynamic Mesh Combining</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithms/">Algorithms</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Game-Development/">Game Development</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity/">Unity</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/default/">default</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithms/">Algorithms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Basics/">Basics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Games/">Games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Geometry/">Geometry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linear-Algebra/">Linear Algebra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/">Math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mathematics/">Mathematics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numerical-Analysis/">Numerical Analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Patterns/">Patterns</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scripting/">Scripting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/">Unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/default/">default</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algorithms/" style="font-size: 10px;">Algorithms</a> <a href="/tags/Basics/" style="font-size: 15px;">Basics</a> <a href="/tags/C/" style="font-size: 13.33px;">C#</a> <a href="/tags/Games/" style="font-size: 10px;">Games</a> <a href="/tags/Geometry/" style="font-size: 11.67px;">Geometry</a> <a href="/tags/Linear-Algebra/" style="font-size: 16.67px;">Linear Algebra</a> <a href="/tags/Math/" style="font-size: 15px;">Math</a> <a href="/tags/Mathematics/" style="font-size: 15px;">Mathematics</a> <a href="/tags/Numerical-Analysis/" style="font-size: 10px;">Numerical Analysis</a> <a href="/tags/Patterns/" style="font-size: 10px;">Patterns</a> <a href="/tags/Scripting/" style="font-size: 13.33px;">Scripting</a> <a href="/tags/Unity/" style="font-size: 20px;">Unity</a> <a href="/tags/default/" style="font-size: 18.33px;">default</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/02/16/Algorithms-Data-Structure/">算法:数据结构</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms-Sorting/">算法：排序</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms-Test-Bed/">搭建算法测试环境</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms-Basics/">Algorithms Basics</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms/">Algorithms</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 To Span<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>