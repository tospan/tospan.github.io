<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Are two rectangles with orientation in 2D space intersecting | 吐司片的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I’ve recently had the need to detect if two rectangles with orientation are intersecting:">
<meta property="og:type" content="article">
<meta property="og:title" content="Are two rectangles with orientation in 2D space intersecting">
<meta property="og:url" content="http://tospan.me/2017/02/05/Are-two-rectangles-with-orientation-in-2D-space-intersecting/index.html">
<meta property="og:site_name" content="吐司片的博客">
<meta property="og:description" content="I’ve recently had the need to detect if two rectangles with orientation are intersecting:">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/rectangle-rectangle-intersection-intro.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/rectangle-rectangle-intersection-test.png">
<meta property="og:updated_time" content="2017-02-08T03:23:18.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Are two rectangles with orientation in 2D space intersecting">
<meta name="twitter:description" content="I’ve recently had the need to detect if two rectangles with orientation are intersecting:">
<meta name="twitter:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/rectangle-rectangle-intersection-intro.png">
  
    <link rel="alternate" href="/atom.xml" title="吐司片的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">吐司片的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Work hard, play hard.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://tospan.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Are-two-rectangles-with-orientation-in-2D-space-intersecting" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/05/Are-two-rectangles-with-orientation-in-2D-space-intersecting/" class="article-date">
  <time datetime="2017-02-05T02:57:56.000Z" itemprop="datePublished">2017-02-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Game-Development/">Game Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Are two rectangles with orientation in 2D space intersecting
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ve recently had the need to detect if two rectangles with orientation are intersecting:</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/rectangle-rectangle-intersection-intro.png" alt="Rectangle rectangle intersection intro"></p>
<a id="more"></a>
<p>The method I first used was to use the triangle-triangle from the previous tutorial: 6. Are two triangles in 2D space intersecting?. The reason this is working is because a rectangle consists of two triangles, and then you test if any of the four possible triangle-triangle intersections are intersecting. But what if there is a better way?</p>
<p>A better way could be the <strong>Separating Axis Theorem (SAT)</strong> algorithm. With that algorithm you can detect if two convex polygons are intersecting. And since a rectangle is just a polygon with four sides, it’s possible to use the algorithm to test if two rectangles are intersecting. I will not explain the ideas behind the algorithm here because it has aldready been done elsewhere and there’s no need to copy the Internet all over again. Anyway, these are the sources I think explain the SAT algorithm:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=IELWpIGtjRg" target="_blank" rel="external">2D collision detection (SAT)</a></li>
<li><a href="https://www.youtube.com/watch?v=OjEks7PmZ2Q" target="_blank" rel="external">TypeScript Game Dev - Separating Axis Theorem</a></li>
<li><a href="http://www.euclideanspace.com/threed/games/examples/cars/collisions/index.htm" target="_blank" rel="external">3D Theory - Example - Car Racing Game - Collisions</a></li>
<li><a href="http://gamedev.stackexchange.com/questions/25397/obb-vs-obb-collision-detection" target="_blank" rel="external">OBB vs OBB Collision Detection</a></li>
<li><a href="http://www.dyn4j.org/2010/01/sat/" target="_blank" rel="external">SAT (Separating Axis Theorem)</a></li>
<li><a href="http://www.gamedev.net/page/resources/_/technical/game-programming/2d-rotated-rectangle-collision-r2604" target="_blank" rel="external">2D Rotated Rectangle Collision</a></li>
<li><a href="http://www.metanetsoftware.com/technique/tutorialA.html" target="_blank" rel="external">N Tutorial A - Collision Detection and Response</a></li>
<li><a href="https://gamedevelopment.tutsplus.com/tutorials/collision-detection-using-the-separating-axis-theorem--gamedev-169" target="_blank" rel="external">Collision Detection Using the Separating Axis Theorem</a></li>
</ul>
<p>But before we begin we need a scene. You need to create the following: just two cubes that will act as our rectangles. Then add the following code (we will soon add the intersection methods):</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"></div><div class="line"><span class="comment">//Are 2 rectangles with orientation (in 2d space) colliding?</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OBBIntersection</span> : <span class="title">MonoBehaviour</span> </div><div class="line">&#123;</div><div class="line">    <span class="comment">//Rectangles</span></div><div class="line">    <span class="keyword">public</span> Transform r1;</div><div class="line">    <span class="keyword">public</span> Transform r2;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>) </span></div><div class="line">    &#123;</div><div class="line">        RectangleRectangle();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//Rectangle-rectangle collision</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RectangleRectangle</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//Find the corners of each rectangle</span></div><div class="line">        <span class="comment">//Rectangle 1</span></div><div class="line">        Vector3 r1_FL, r1_FR, r1_BL, r1_BR = Vector3.zero;</div><div class="line"></div><div class="line">        GetCornerPositions(r1, <span class="keyword">out</span> r1_FL, <span class="keyword">out</span> r1_FR, <span class="keyword">out</span> r1_BL, <span class="keyword">out</span> r1_BR);</div><div class="line"></div><div class="line">        <span class="comment">//Rectangle 2</span></div><div class="line">        Vector3 r2_FL, r2_FR, r2_BL, r2_BR = Vector3.zero;</div><div class="line"></div><div class="line">        GetCornerPositions(r2, <span class="keyword">out</span> r2_FL, <span class="keyword">out</span> r2_FR, <span class="keyword">out</span> r2_BL, <span class="keyword">out</span> r2_BR);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//Are the rectangles intersecting?</span></div><div class="line"></div><div class="line">        <span class="comment">//Method 1 - Check for intersection with the Separating Axis Theorem (SAT)</span></div><div class="line">        <span class="keyword">bool</span> isIntersecting1 = Intersections.IsIntersectingOBBRectangleRectangle(r1_FL, r1_FR, r1_BL, r1_BR, r2_FL, r2_FR, r2_BL, r2_BR);</div><div class="line"></div><div class="line">        <span class="comment">//Method 2 - Check for intersection with triangle-triangle intersection</span></div><div class="line">        <span class="comment">//bool isIntersecting2 = TriangleTriangle(r1_FL, r1_FR, r1_BL, r1_BR, r2_FL, r2_FR, r2_BL, r2_BR);</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> (isIntersecting1)</div><div class="line">        &#123;</div><div class="line">            r1.GetComponent&lt;MeshRenderer&gt;().material.color = Color.red;</div><div class="line">            r2.GetComponent&lt;MeshRenderer&gt;().material.color = Color.red;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            r1.GetComponent&lt;MeshRenderer&gt;().material.color = Color.blue;</div><div class="line">            r2.GetComponent&lt;MeshRenderer&gt;().material.color = Color.blue;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//Find the corners of a rectangle transform</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">GetCornerPositions</span>(<span class="params">Transform r, <span class="keyword">out</span> Vector3 FL, <span class="keyword">out</span> Vector3 FR, <span class="keyword">out</span> Vector3 BL, <span class="keyword">out</span> Vector3 BR</span>)</span></div><div class="line">    &#123;</div><div class="line">        FL = r.position + r.forward * r.localScale.z * <span class="number">0.5</span>f - r.right * r.localScale.x * <span class="number">0.5</span>f;</div><div class="line">        FR = r.position + r.forward * r.localScale.z * <span class="number">0.5</span>f + r.right * r.localScale.x * <span class="number">0.5</span>f;</div><div class="line"></div><div class="line">        BL = r.position - r.forward * r.localScale.z * <span class="number">0.5</span>f - r.right * r.localScale.x * <span class="number">0.5</span>f;</div><div class="line">        BR = r.position - r.forward * r.localScale.z * <span class="number">0.5</span>f + r.right * r.localScale.x * <span class="number">0.5</span>f;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//Rectangle-rectangle intersection by using triangle-triangle intersection for comparisons</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">bool</span> <span class="title">TriangleTriangle</span>(<span class="params"></span></span></div><div class="line">        Vector3 r1_FL, Vector3 r1_FR, Vector3 r1_BL, Vector3 r1_BR,</div><div class="line">        Vector3 r2_FL, Vector3 r2_FR, Vector3 r2_BL, Vector3 r2_BR)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">bool</span> isIntersecting = <span class="literal">false</span>;</div><div class="line">		</div><div class="line">        <span class="comment">//The same algorithm from the rectangle-rectangle intersection tutorial so use the code from that one</span></div><div class="line">        <span class="keyword">if</span> (Intersections.IsTriangleTriangleIntersecting(r1_FL, r1_FR, r1_BR, r2_FL, r2_FR, r2_BR))</div><div class="line">        &#123;</div><div class="line">            isIntersecting = <span class="literal">true</span>;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> isIntersecting;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (Intersections.IsTriangleTriangleIntersecting(r1_FL, r1_FR, r1_BR, r2_FL, r2_BR, r2_BL))</div><div class="line">        &#123;</div><div class="line">            isIntersecting = <span class="literal">true</span>;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> isIntersecting;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (Intersections.IsTriangleTriangleIntersecting(r1_FL, r1_BR, r1_BL, r2_FL, r2_BR, r2_BL))</div><div class="line">        &#123;</div><div class="line">            isIntersecting = <span class="literal">true</span>;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> isIntersecting;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (Intersections.IsTriangleTriangleIntersecting(r1_FL, r1_BL, r1_BR, r2_FL, r2_FR, r2_BR))</div><div class="line">        &#123;</div><div class="line">            isIntersecting = <span class="literal">true</span>;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> isIntersecting;</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">        <span class="keyword">return</span> isIntersecting;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="The-intersection-algorithm"><a href="#The-intersection-algorithm" class="headerlink" title="The intersection algorithm"></a>The intersection algorithm</h2><p>I’ve here collected all intersection methods in a static class called Intersections.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Rectangle-rectangle in 2d space with orientation</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsIntersectingOBBRectangleRectangle</span>(<span class="params"></span></span></div><div class="line">	Vector3 r1_FL, Vector3 r1_FR, Vector3 r1_BL, Vector3 r1_BR,</div><div class="line">	Vector3 r2_FL, Vector3 r2_FR, Vector3 r2_BL, Vector3 r2_BR)</div><div class="line">&#123;</div><div class="line">	<span class="keyword">bool</span> isIntersecting = <span class="literal">false</span>;</div><div class="line"></div><div class="line">	<span class="comment">//Create the rectangles</span></div><div class="line">	Rectangle r1 = <span class="keyword">new</span> Rectangle(r1_FL, r1_FR, r1_BL, r1_BR);</div><div class="line">	Rectangle r2 = <span class="keyword">new</span> Rectangle(r2_FL, r2_FR, r2_BL, r2_BR);</div><div class="line"></div><div class="line">	<span class="comment">//Find out if the rectangles are intersecting by approximating them with rectangles </span></div><div class="line">	<span class="comment">//with no rotation and then use AABB intersection</span></div><div class="line">	<span class="comment">//Will make it faster if the probability that the rectangles are intersecting is low</span></div><div class="line">	<span class="keyword">if</span> (!IsIntersectingAABB_OBB(r1, r2))</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> isIntersecting;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//Find out if the rectangles are intersecting by using the Separating Axis Theorem (SAT)</span></div><div class="line">	isIntersecting = SATRectangleRectangle(r1, r2);</div><div class="line"></div><div class="line">	<span class="keyword">return</span> isIntersecting;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Find out if the rectangles are intersecting by using AABB</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsIntersectingAABB_OBB</span>(<span class="params">Rectangle r1, Rectangle r2</span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">bool</span> isIntersecting = <span class="literal">false</span>;</div><div class="line"></div><div class="line">	<span class="comment">//Find the min/max values for the AABB algorithm</span></div><div class="line">	<span class="keyword">float</span> r1_minX = Mathf.Min(r1.FL.x, Mathf.Min(r1.FR.x, Mathf.Min(r1.BL.x, r1.BR.x)));</div><div class="line">	<span class="keyword">float</span> r1_maxX = Mathf.Max(r1.FL.x, Mathf.Max(r1.FR.x, Mathf.Max(r1.BL.x, r1.BR.x)));</div><div class="line"></div><div class="line">	<span class="keyword">float</span> r2_minX = Mathf.Min(r2.FL.x, Mathf.Min(r2.FR.x, Mathf.Min(r2.BL.x, r2.BR.x)));</div><div class="line">	<span class="keyword">float</span> r2_maxX = Mathf.Max(r2.FL.x, Mathf.Max(r2.FR.x, Mathf.Max(r2.BL.x, r2.BR.x)));</div><div class="line"></div><div class="line">	<span class="keyword">float</span> r1_minZ = Mathf.Min(r1.FL.z, Mathf.Min(r1.FR.z, Mathf.Min(r1.BL.z, r1.BR.z)));</div><div class="line">	<span class="keyword">float</span> r1_maxZ = Mathf.Max(r1.FL.z, Mathf.Max(r1.FR.z, Mathf.Max(r1.BL.z, r1.BR.z)));</div><div class="line"></div><div class="line">	<span class="keyword">float</span> r2_minZ = Mathf.Min(r2.FL.z, Mathf.Min(r2.FR.z, Mathf.Min(r2.BL.z, r2.BR.z)));</div><div class="line">	<span class="keyword">float</span> r2_maxZ = Mathf.Max(r2.FL.z, Mathf.Max(r2.FR.z, Mathf.Max(r2.BL.z, r2.BR.z)));</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (IsIntersectingAABB(r1_minX, r1_maxX, r1_minZ, r1_maxZ, r2_minX, r2_maxX, r2_minZ, r2_maxZ))</div><div class="line">	&#123;</div><div class="line">		isIntersecting = <span class="literal">true</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> isIntersecting;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Intersection: AABB-AABB (Axis-Aligned Bounding Box) - rectangle-rectangle in 2d space with no orientation</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsIntersectingAABB</span>(<span class="params"></span></span></div><div class="line">	<span class="keyword">float</span> r1_minX, <span class="keyword">float</span> r1_maxX, <span class="keyword">float</span> r1_minZ, <span class="keyword">float</span> r1_maxZ, </div><div class="line">	<span class="keyword">float</span> r2_minX, <span class="keyword">float</span> r2_maxX, <span class="keyword">float</span> r2_minZ, <span class="keyword">float</span> r2_maxZ)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//If the min of one box in one dimension is greater than the max of another box then the boxes are not intersecting</span></div><div class="line">	<span class="comment">//They have to intersect in 2 dimensions. We have to test if box 1 is to the left or box 2 and vice versa</span></div><div class="line">	<span class="keyword">bool</span> isIntersecting = <span class="literal">true</span>;</div><div class="line"></div><div class="line">	<span class="comment">//X axis</span></div><div class="line">	<span class="keyword">if</span> (r1_minX &gt; r2_maxX)</div><div class="line">	&#123;</div><div class="line">		isIntersecting = <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">r2_minX &gt; r1_maxX</span>)</span></div><div class="line">	&#123;</div><div class="line">		isIntersecting = <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//Z axis</span></div><div class="line">	<span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">r1_minZ &gt; r2_maxZ</span>)</span></div><div class="line">	&#123;</div><div class="line">		isIntersecting = <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">r2_minZ &gt; r1_maxZ</span>)</span></div><div class="line">	&#123;</div><div class="line">		isIntersecting = <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">return</span> isIntersecting;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Find out if 2 rectangles with orientation are intersecting by using the SAT algorithm</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">SATRectangleRectangle</span>(<span class="params">Rectangle r1, Rectangle r2</span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">bool</span> isIntersecting = <span class="literal">false</span>;</div><div class="line"></div><div class="line">	<span class="comment">//We have just 4 normals because the other 4 normals are the same but in another direction</span></div><div class="line">	<span class="comment">//So we only need a maximum of 4 tests if we have rectangles</span></div><div class="line">	<span class="comment">//It is enough if one side is not overlapping, if so we know the rectangles are not intersecting</span></div><div class="line"></div><div class="line">	<span class="comment">//Test 1</span></div><div class="line">	Vector3 normal1 = GetNormal(r1.BL, r1.FL);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!IsOverlapping(normal1, r1, r2))</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//No intersection is possible!</span></div><div class="line">		<span class="keyword">return</span> isIntersecting;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//Test 2</span></div><div class="line">	Vector3 normal2 = GetNormal(r1.FL, r1.FR);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!IsOverlapping(normal2, r1, r2))</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> isIntersecting;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//Test 3</span></div><div class="line">	Vector3 normal3 = GetNormal(r2.BL, r2.FL);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!IsOverlapping(normal3, r1, r2))</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> isIntersecting;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//Test 4</span></div><div class="line">	Vector3 normal4 = GetNormal(r2.FL, r2.FR);</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!IsOverlapping(normal4, r1, r2))</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> isIntersecting;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//If we have come this far, then we know all sides are overlapping</span></div><div class="line">	<span class="comment">//So the rectangles are intersecting!</span></div><div class="line">	isIntersecting = <span class="literal">true</span>;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> isIntersecting;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Is this side overlapping?</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsOverlapping</span>(<span class="params">Vector3 normal, Rectangle r1, Rectangle r2</span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">bool</span> isOverlapping = <span class="literal">false</span>;</div><div class="line"></div><div class="line">	<span class="comment">//Project the corners of rectangle 1 onto the normal</span></div><div class="line">	<span class="keyword">float</span> dot1 = DotProduct(normal, r1.FL);</div><div class="line">	<span class="keyword">float</span> dot2 = DotProduct(normal, r1.FR);</div><div class="line">	<span class="keyword">float</span> dot3 = DotProduct(normal, r1.BL);</div><div class="line">	<span class="keyword">float</span> dot4 = DotProduct(normal, r1.BR);</div><div class="line"></div><div class="line">	<span class="comment">//Find the range</span></div><div class="line">	<span class="keyword">float</span> min1 = Mathf.Min(dot1, Mathf.Min(dot2, Mathf.Min(dot3, dot4)));</div><div class="line">	<span class="keyword">float</span> max1 = Mathf.Max(dot1, Mathf.Max(dot2, Mathf.Max(dot3, dot4)));</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//Project the corners of rectangle 2 onto the normal</span></div><div class="line">	<span class="keyword">float</span> dot5 = DotProduct(normal, r2.FL);</div><div class="line">	<span class="keyword">float</span> dot6 = DotProduct(normal, r2.FR);</div><div class="line">	<span class="keyword">float</span> dot7 = DotProduct(normal, r2.BL);</div><div class="line">	<span class="keyword">float</span> dot8 = DotProduct(normal, r2.BR);</div><div class="line"></div><div class="line">	<span class="comment">//Find the range</span></div><div class="line">	<span class="keyword">float</span> min2 = Mathf.Min(dot5, Mathf.Min(dot6, Mathf.Min(dot7, dot8)));</div><div class="line">	<span class="keyword">float</span> max2 = Mathf.Max(dot5, Mathf.Max(dot6, Mathf.Max(dot7, dot8)));</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//Are the ranges overlapping?</span></div><div class="line">	<span class="keyword">if</span> (min1 &lt;= max2 &amp;&amp; min2 &lt;= max1)</div><div class="line">	&#123;</div><div class="line">		isOverlapping = <span class="literal">true</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> isOverlapping;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Get the normal from 2 points. This normal is pointing left in the direction start -&gt; end</span></div><div class="line"><span class="comment">//But it doesn't matter in which direction the normal is pointing as long as you have the same</span></div><div class="line"><span class="comment">//algorithm for all edges</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Vector3 <span class="title">GetNormal</span>(<span class="params">Vector3 startPos, Vector3 endPos</span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//The direction</span></div><div class="line">	Vector3 dir = endPos - startPos;</div><div class="line"></div><div class="line">	<span class="comment">//The normal, just flip x and z and make one negative (don't need to normalize it)</span></div><div class="line">	Vector3 normal = <span class="keyword">new</span> Vector3(-dir.z, dir.y, dir.x);</div><div class="line"></div><div class="line">	<span class="comment">//Draw the normal from the center of the rectangle's side</span></div><div class="line">	Debug.DrawRay(startPos + (dir * <span class="number">0.5</span>f), normal.normalized * <span class="number">2</span>f, Color.red);</div><div class="line"></div><div class="line">	<span class="keyword">return</span> normal;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Get the dot product</span></div><div class="line"><span class="comment">//p - the vector we want to project</span></div><div class="line"><span class="comment">//u - the unit vector p is being projected on</span></div><div class="line"><span class="comment">//proj_p_on_u = Vector3.Dot(p, u) * u;</span></div><div class="line"><span class="comment">//But we only need to project a point, so just Vector3.Dot(p, u)</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">float</span> <span class="title">DotProduct</span>(<span class="params">Vector3 v1, Vector3 v2</span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//2d space</span></div><div class="line">	<span class="keyword">float</span> dotProduct = v1.x * v2.x + v1.z * v2.z;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> dotProduct;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//To create a rectangle</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">struct</span> Rectangle</div><div class="line">&#123;</div><div class="line">	<span class="comment">//Corners</span></div><div class="line">	<span class="keyword">public</span> Vector3 FL, FR, BL, BR;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Rectangle</span>(<span class="params">Vector3 FL, Vector3 FR, Vector3 BL, Vector3 BR</span>)</span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">this</span>.FL = FL;</div><div class="line">		<span class="keyword">this</span>.FR = FR;</div><div class="line">		<span class="keyword">this</span>.BL = BL;</div><div class="line">		<span class="keyword">this</span>.BR = BR;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>It should look like this in Unity (the red lines are the normals we need to project the corners onto):</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/rectangle-rectangle-intersection-test.png" alt="Intersection of a rectangles"></p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>But is it faster to detect if two rectangles are intersecting with the Separating Axis Theorem than it is to approximate the rectangles with triangles and then use the triangle-triangle intersection algorithm? The answer is not really. This is the result after 2000 updates:</p>
<ul>
<li><strong>SAT:</strong> 00.0629384 seconds</li>
<li><strong>Triangle-triangle:</strong> 00.0537138 seconds</li>
</ul>
<p>So SAT is actullay slower than if we approximate the rectangles with triangles and then use the triangle-triangle intersection algorithm. But if you have a more complicated convex shape with more sides, then SAT will (probably) be faster. And since you now know the basic idea behind the SAT algorithm, it will be much easier to modify the code to make it work with more complicated shapes!</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.habrador.com/tutorials/linear-algebra/7-rectangle-rectangle-intersection/" target="_blank" rel="external">Are two rectangles with orientation in 2D space intersecting?</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tospan.me/2017/02/05/Are-two-rectangles-with-orientation-in-2D-space-intersecting/" data-id="cizcqkka8000dagvwixjvwn95" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linear-Algebra/">Linear Algebra</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Math/">Math</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity/">Unity</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/02/05/How-to-make-Dubins-Paths-in-Unity/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          在Unity中制作Dubins曲线(C#)
        
      </div>
    </a>
  
  
    <a href="/2017/02/05/Are-two-triangles-in-2D-space-intersecting/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Are two triangles in 2D space intersecting</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithms/">Algorithms</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Game-Development/">Game Development</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity/">Unity</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/default/">default</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithms/">Algorithms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Basics/">Basics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Games/">Games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Geometry/">Geometry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linear-Algebra/">Linear Algebra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/">Math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mathematics/">Mathematics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numerical-Analysis/">Numerical Analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Patterns/">Patterns</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scripting/">Scripting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/">Unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/default/">default</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algorithms/" style="font-size: 10px;">Algorithms</a> <a href="/tags/Basics/" style="font-size: 15px;">Basics</a> <a href="/tags/C/" style="font-size: 13.33px;">C#</a> <a href="/tags/Games/" style="font-size: 10px;">Games</a> <a href="/tags/Geometry/" style="font-size: 11.67px;">Geometry</a> <a href="/tags/Linear-Algebra/" style="font-size: 16.67px;">Linear Algebra</a> <a href="/tags/Math/" style="font-size: 15px;">Math</a> <a href="/tags/Mathematics/" style="font-size: 15px;">Mathematics</a> <a href="/tags/Numerical-Analysis/" style="font-size: 10px;">Numerical Analysis</a> <a href="/tags/Patterns/" style="font-size: 10px;">Patterns</a> <a href="/tags/Scripting/" style="font-size: 13.33px;">Scripting</a> <a href="/tags/Unity/" style="font-size: 20px;">Unity</a> <a href="/tags/default/" style="font-size: 18.33px;">default</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/02/16/Algorithms-Data-Structure/">算法:数据结构</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms-Sorting/">算法：排序</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms-Test-Bed/">搭建算法测试环境</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms-Basics/">Algorithms Basics</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms/">Algorithms</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 To Span<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>