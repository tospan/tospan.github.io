<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Unity Make a realistic bullets | 吐司片的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="IntroductionIn this tutorial you will learn how to make realistic bullets in Unity. You will need this tutorial if you are building a game where accuracy is important, such as a sniper game or if you">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity Make a realistic bullets">
<meta property="og:url" content="http://tospan.me/2017/02/05/Unity-Make-a-realistic-bullets/index.html">
<meta property="og:site_name" content="吐司片的博客">
<meta property="og:description" content="IntroductionIn this tutorial you will learn how to make realistic bullets in Unity. You will need this tutorial if you are building a game where accuracy is important, such as a sniper game or if you">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/unity-bullets-snipers-artillery.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/initial-scene.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/gif-realistic-bullets-tutorial-unity-small.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-path-backward-euler.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-accuracy-backward-euler.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-accuracy-euler-forward.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-accuracy-heuns-method.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-accuracy-heuns-method-2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-missing-target.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/sniper-start-scene.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/sniper-final-scene-1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/sniper-final-scene-2.png">
<meta property="og:updated_time" content="2017-02-05T06:12:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unity Make a realistic bullets">
<meta name="twitter:description" content="IntroductionIn this tutorial you will learn how to make realistic bullets in Unity. You will need this tutorial if you are building a game where accuracy is important, such as a sniper game or if you">
<meta name="twitter:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/unity-bullets-snipers-artillery.png">
  
    <link rel="alternate" href="/atom.xml" title="吐司片的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">吐司片的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Work hard, play hard.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://tospan.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Unity-Make-a-realistic-bullets" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/05/Unity-Make-a-realistic-bullets/" class="article-date">
  <time datetime="2017-02-05T06:12:33.000Z" itemprop="datePublished">2017-02-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity/">Unity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Unity Make a realistic bullets
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/unity-bullets-snipers-artillery.png" alt=""></p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In this tutorial you will learn how to make realistic bullets in Unity. You will need this tutorial if you are building a game where accuracy is important, such as a sniper game or if you are firing long-range artillery. You will also learn about Unity’s physics engine, so if you are not into war you will also learn something new.</p>
<a id="more"></a>
<ul>
<li>In part 1 (this part) you will create the basic scene you will need.</li>
<li>In part 2 you will learn how to calculate the angle you need to hit a target and display the trajectory path the bullet will take to hit the target.</li>
<li>In part 3 you will learn how to improve the accuracy of the bullet. We will see that Unity’s physics engine is not accurate enough if you want to hit a target with high accuracy. So you have to build your own physics engine, but it’s just a few lines of code, so don’t worry.</li>
<li>In part 4 you will add the various forces that might affect the bullet, such as drag force and wind.</li>
<li>In part 5 you will add a sniper rifle.</li>
</ul>
<h3 id="Init"><a href="#Init" class="headerlink" title="Init"></a>Init</h3><p>But before we begin we need a basic scene. First create a plane and rename it “Ground” and scale it to 5. Then create a box and rename it “Target” and a sphere called “Bullet” with a scale of 0.1. Make the bullet a prefab. Then create an empty Game Object called “Bullets parent” to which we will parent the bullets to get a less messy scene.</p>
<p>Now we need something that can fire bullets. Create an empty Game Object and rename it to “Turret.” To this turret you should add a Line Renderer so we can display the bullet’s path through the air. The turret also needs a body, so add a cube as a child to the Turret with position (0, 0.25, 0) and sscale (1, 0.5, 1).</p>
<p>Add an empty Game Object as a child to the Turret and rename it “Barrel connector.” Position it at (0, 0.5, 0) in relation to the Turret so it sits on the top of the turret. Next add a cylinder as a child to the Barrel connector, and rename it to “Barrel.” Resize it to (0.3, 1, 0.3), rotate it to (90, 0, 0) and position it at (0, 0, 1).</p>
<p>Make sure you can rotate the barrel if you are rotating the barrel connector, that you can rotate the turret, and that it looks like a turret with a gun by adding materials. Anyway, the exact dimensions are not important, but your scene should look like this (Ignore the GameController, it is just holding the camera and the light):</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/initial-scene.png" alt="Unity realistic bullets tutorial initial scene"><br>Now let’s fire the gun!</p>
<h2 id="Targeting"><a href="#Targeting" class="headerlink" title="Targeting"></a>Targeting</h2><p>When you are finished with this section of the tutorial you will have something that looks like this:</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/gif-realistic-bullets-tutorial-unity-small.gif" alt="Realistic bullets tutorial part 2 finished gif"></p>
<h3 id="Part-1-Fire-bullets"><a href="#Part-1-Fire-bullets" class="headerlink" title="Part 1. Fire bullets"></a>Part 1. Fire bullets</h3><p>This tutorial is all about ballistics so I believe the first thing we have to do is to make the turret fire bullets. So create a script called TutorialFireBullets and add the following to it. It’s relatively self-explanatory, but the basic idea is to fire a bullet every 2 seconds from the Barrel connector Game Object, so add the script to it.</p>
<p>You also need to add a RigidBody to the bullet so it can fly. Make sure to not add any drag and the mass is not important. The script will give the bullet a speed in the direction the barrel is pointing after parenting the bullet to its parent GameObject so we get a clean workpace. So don’t forget to drag the bullet prefab and the Bullets parent Game Object to the script. If you press play you should see bullets fly out of the turret (if you replace TutorialBallistics.bulletSpeed with something like 30f).</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TutorialFireBullets</span> : <span class="title">MonoBehaviour</span> </div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> GameObject bulletObj;</div><div class="line">    <span class="keyword">public</span> Transform bulletParent;</div><div class="line">	</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>) </span></div><div class="line">    &#123;</div><div class="line">        StartCoroutine(FireBullet());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">FireBullet</span>(<span class="params"></span>) </span></div><div class="line">    &#123;        </div><div class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">//Create a new bullet</span></div><div class="line">            GameObject newBullet = Instantiate(bulletObj, transform.position, transform.rotation) <span class="keyword">as</span> GameObject;</div><div class="line"></div><div class="line">            <span class="comment">//Parent it to get a less messy workspace</span></div><div class="line">            newBullet.transform.parent = bulletParent;</div><div class="line"></div><div class="line">            <span class="comment">//Add velocity to the bullet with a rigidbody</span></div><div class="line">            newBullet.GetComponent&lt;Rigidbody&gt;().velocity = TutorialBallistics.bulletSpeed * transform.forward;</div><div class="line"></div><div class="line">            <span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">2</span>f</span>)</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Part-2-Find-the-angle-to-hit-a-target"><a href="#Part-2-Find-the-angle-to-hit-a-target" class="headerlink" title="Part 2. Find the angle to hit a target"></a>Part 2. Find the angle to hit a target</h3><p>But bullets flying out from a turret will not kill any targets. What we need is a script called TutorialBallistics, so create it. Also drag the Target cube and the Barrel connector Game Object to the script. Don’t worry if you don’t understand step size, I can guarantee that you will when the tutorial is over.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TutorialBallistics</span> : <span class="title">MonoBehaviour</span> </div><div class="line">&#123;</div><div class="line">    <span class="comment">//Drags</span></div><div class="line">    <span class="keyword">public</span> Transform targetObj;</div><div class="line">    <span class="keyword">public</span> Transform gunObj;</div><div class="line"></div><div class="line">    <span class="comment">//The bullet's initial speed in m/s</span></div><div class="line">    <span class="comment">//Sniper rifle</span></div><div class="line">    <span class="comment">//public static float bulletSpeed = 850f;</span></div><div class="line">    <span class="comment">//Test</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> bulletSpeed = <span class="number">20</span>f;</div><div class="line"></div><div class="line">    <span class="comment">//The step size</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">float</span> h;</div><div class="line"></div><div class="line">    <span class="comment">//For debugging</span></div><div class="line">    <span class="keyword">private</span> LineRenderer lineRenderer;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//Can use a less precise h to speed up calculations</span></div><div class="line">        <span class="comment">//Or a more precise to get a more accurate result</span></div><div class="line">        <span class="comment">//But lower is not always better because of rounding errors</span></div><div class="line">        h = Time.fixedDeltaTime * <span class="number">1</span>f;</div><div class="line">        </div><div class="line">        lineRenderer = GetComponent&lt;LineRenderer&gt;();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        RotateGun();</div><div class="line"></div><div class="line">        <span class="comment">//DrawTrajectoryPath();</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we will rotate the barrel so it aims at the target box. To help us we are going to use an equation called <strong>Angle theta required to hit coordinate (x,y)</strong> from Wikipedia’s <a href="https://en.wikipedia.org/wiki/Trajectory_of_a_projectile#Angle_required_to_hit_coordinate_.28x.2Cy.29" target="_blank" rel="external">Trajectory of a projectile</a>. That equation will give us 2 angles or none angles if the target is out of range. The angle in the script called highAngle will rotate the barrel to a rotation similar to an artilley gun, while the lowAngle will give us a rotation similar to a sniper rifle. The artillery will try to hit the target from above, while the sniper rifle will try to hit the target from the front. So create a method called RotateGun.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Rotate the gun and the turret</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">RotateGun</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//Get the 2 angles</span></div><div class="line">	<span class="keyword">float</span>? highAngle = <span class="number">0</span>f;</div><div class="line">	<span class="keyword">float</span>? lowAngle = <span class="number">0</span>f;</div><div class="line">	</div><div class="line">	CalculateAngleToHitTarget(<span class="keyword">out</span> highAngle, <span class="keyword">out</span> lowAngle);</div><div class="line"></div><div class="line">	<span class="comment">//Artillery</span></div><div class="line">	<span class="keyword">float</span> angle = (<span class="keyword">float</span>)highAngle;</div><div class="line">	<span class="comment">//Regular gun</span></div><div class="line">	<span class="comment">//float angle = (float)lowAngle;</span></div><div class="line"></div><div class="line">	<span class="comment">//If we are within range</span></div><div class="line">	<span class="keyword">if</span> (angle != <span class="literal">null</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//Rotate the gun</span></div><div class="line">		<span class="comment">//The equation we use assumes that if we are rotating the gun up from the</span></div><div class="line">		<span class="comment">//pointing "forward" position, the angle increase from 0, but our gun's angles</span></div><div class="line">		<span class="comment">//decreases from 360 degress when we are rotating up</span></div><div class="line">		gunObj.localEulerAngles = <span class="keyword">new</span> Vector3(<span class="number">360</span>f - angle, <span class="number">0</span>f, <span class="number">0</span>f);</div><div class="line"></div><div class="line">		<span class="comment">//Rotate the turret towards the target</span></div><div class="line">		transform.LookAt(targetObj);</div><div class="line">		transform.eulerAngles = <span class="keyword">new</span> Vector3(<span class="number">0</span>f, transform.rotation.eulerAngles.y, <span class="number">0</span>f);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>…and a method called CalculateAngleToHitTarget() which will apply the equation from Wikipedia. If you then press play you should be able to drag the Target cube around the scene (if you are in Scene view) and the barrel should rotate up and down.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">//Which angle do we need to hit the target?</div><div class="line">//Returns 0, 1, or 2 angles depending on if we are within range</div><div class="line">void CalculateAngleToHitTarget(out float? theta1, out float? theta2)</div><div class="line">&#123;</div><div class="line">	//Initial speed</div><div class="line">	float v = bulletSpeed;</div><div class="line"></div><div class="line">	Vector3 targetVec = targetObj.position - gunObj.position;</div><div class="line"></div><div class="line">	//Vertical distance</div><div class="line">	float y = targetVec.y;</div><div class="line"></div><div class="line">	//Reset y so we can get the horizontal distance x</div><div class="line">	targetVec.y = 0f;</div><div class="line"></div><div class="line">	//Horizontal distance</div><div class="line">	float x = targetVec.magnitude;</div><div class="line"></div><div class="line">	//Gravity</div><div class="line">	float g = 9.81f;</div><div class="line"></div><div class="line"></div><div class="line">	//Calculate the angles</div><div class="line">	</div><div class="line">	float vSqr = v * v;</div><div class="line"></div><div class="line">	float underTheRoot = (vSqr * vSqr) - g * (g * x * x + 2 * y * vSqr);</div><div class="line"></div><div class="line">	//Check if we are within range</div><div class="line">	if (underTheRoot &gt;= 0f)</div><div class="line">	&#123;</div><div class="line">		float rightSide = Mathf.Sqrt(underTheRoot);</div><div class="line"></div><div class="line">		float top1 = vSqr + rightSide;</div><div class="line">		float top2 = vSqr - rightSide;</div><div class="line"></div><div class="line">		float bottom = g * x;</div><div class="line"></div><div class="line">		theta1 = Mathf.Atan2(top1, bottom) * Mathf.Rad2Deg;</div><div class="line">		theta2 = Mathf.Atan2(top2, bottom) * Mathf.Rad2Deg;</div><div class="line">	&#125;</div><div class="line">	else</div><div class="line">	&#123;</div><div class="line">		theta1 = null;</div><div class="line">		theta2 = null;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Part-3-Display-the-trajectory-curve"><a href="#Part-3-Display-the-trajectory-curve" class="headerlink" title="Part 3. Display the trajectory curve"></a>Part 3. Display the trajectory curve</h3><p>But wouldn’t it be cool to also see the trajectory the bullet takes when it is flying towards the target. If we can make such a trajectory it will also be easier to see what’s happening, because bullets are sometimes very fast. So create a method called DrawTrajectoryPath() and add the following.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Display the trajectory path with a line renderer</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DrawTrajectoryPath</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//How long did it take to hit the target?</span></div><div class="line">	<span class="keyword">float</span> timeToHitTarget = CalculateTimeToHitTarget();</div><div class="line"></div><div class="line">	<span class="comment">//How many segments we will have</span></div><div class="line">	<span class="keyword">int</span> maxIndex = Mathf.RoundToInt(timeToHitTarget / h);</div><div class="line"></div><div class="line">	lineRenderer.SetVertexCount(maxIndex);</div><div class="line"></div><div class="line">	<span class="comment">//Start values</span></div><div class="line">	Vector3 currentVelocity = gunObj.transform.forward * bulletSpeed;</div><div class="line">	Vector3 currentPosition = gunObj.transform.position;</div><div class="line"></div><div class="line">	Vector3 newPosition = Vector3.zero;</div><div class="line">	Vector3 newVelocity = Vector3.zero;</div><div class="line"></div><div class="line">	<span class="comment">//Build the trajectory line</span></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; maxIndex; index++)</div><div class="line">	&#123;</div><div class="line">		lineRenderer.SetPosition(index, currentPosition);</div><div class="line"></div><div class="line">		<span class="comment">//Calculate the new position of the bullet</span></div><div class="line">		TutorialBallistics.CurrentIntegrationMethod(h, currentPosition, currentVelocity, <span class="keyword">out</span> newPosition, <span class="keyword">out</span> newVelocity);</div><div class="line"></div><div class="line">		currentPosition = newPosition;</div><div class="line">		currentVelocity = newVelocity;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>To make it more good looking I’ve decided to first calculate the time it takes to hit the target so the trajectory curve stops when the target has been reached. To be able to do that we have to use a method called <a href="https://en.wikipedia.org/wiki/Numerical_integration" target="_blank" rel="external">numerical integration</a>. The basic idea behind that method is to use tiny steps to make our way from the initial position where the bullet starts and move our way to the position where it will land, without firing any bullet in Unity’s physics engine. We are simulating the bullet’s path.</p>
<p>There are several methods to simulate a bullet’s path, but we are here going to begin with a method called <a href="https://en.wikipedia.org/wiki/Backward_Euler_method" target="_blank" rel="external">Backward Euler</a>, which is similar to the method Unity’s physics engine is usings. I tried to find exactly which method the physics engine is using but didn’t find any good answer. But Backward Euler will yield a similar path as the path the bullet is flying when it has a RigidBody.</p>
<p>The basic idea behind Forward Euler is that if we know the velocity and position at time zero, we will be able to find the velocity and position in the future. To calculate the velocity we are going to use the small time step <strong>h</strong> (calculated in the beginning of this section) in this way: <strong>velocity_next_update = current_velocity + h x acceleration</strong>.  </p>
<p>And if we know the velocity the bullet has, we can calculate its position in this way: <strong>position_next_update = current_position + h x velocity_next_update</strong>. And then we repeat the process until we believe we have hit the target while keeping track of the time. So add the mehod CalculateTimeToHitTarget().</p>
<p>//How long did it take to reach the target (splash in artillery terms)?</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">CalculateTimeToHitTarget</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//Init values</span></div><div class="line">	Vector3 currentVelocity = gunObj.transform.forward * bulletSpeed;</div><div class="line">	Vector3 currentPosition = gunObj.transform.position;</div><div class="line"></div><div class="line">	Vector3 newPosition = Vector3.zero;</div><div class="line">	Vector3 newVelocity = Vector3.zero;</div><div class="line"></div><div class="line">	<span class="comment">//The total time it will take before we hit the target</span></div><div class="line">	<span class="keyword">float</span> time = <span class="number">0</span>f;</div><div class="line"></div><div class="line">	<span class="comment">//Limit to 30 seconds to avoid infinite loop if we never reach the target</span></div><div class="line">	<span class="keyword">for</span> (time = <span class="number">0</span>f; time &lt; <span class="number">30</span>f; time += h)</div><div class="line">	&#123;</div><div class="line">		TutorialBallistics.CurrentIntegrationMethod(h, currentPosition, currentVelocity, <span class="keyword">out</span> newPosition, <span class="keyword">out</span> newVelocity);</div><div class="line"></div><div class="line">		<span class="comment">//If we are moving downwards and are below the target, then we have hit</span></div><div class="line">		<span class="keyword">if</span> (newPosition.y &lt; currentPosition.y &amp;&amp; newPosition.y &lt; targetObj.position.y)</div><div class="line">		&#123;</div><div class="line">			<span class="comment">//Add 2 times to make sure we end up below the target when we display the path</span></div><div class="line">			time += h * <span class="number">2</span>f;</div><div class="line"></div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		currentPosition = newPosition;</div><div class="line">		currentVelocity = newVelocity;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> time;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>…and the method CurrentIntegrationMethod()</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Easier to change integration method once in this method</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CurrentIntegrationMethod</span>(<span class="params"></span></span></div><div class="line">	<span class="keyword">float</span> h,</div><div class="line">	Vector3 currentPosition,</div><div class="line">	Vector3 currentVelocity,</div><div class="line">	<span class="keyword">out</span> Vector3 newPosition,</div><div class="line">	<span class="keyword">out</span> Vector3 newVelocity)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//IntegrationMethods.EulerForward(h, currentPosition, currentVelocity, out newPosition, out newVelocity);</span></div><div class="line">	<span class="comment">//IntegrationMethods.Heuns(h, currentPosition, currentVelocity, out newPosition, out newVelocity);</span></div><div class="line">	<span class="comment">//IntegrationMethods.RungeKutta(h, currentPosition, currentVelocity, out newPosition, out newVelocity);</span></div><div class="line">	IntegrationMethods.BackwardEuler(h, currentPosition, currentVelocity, <span class="keyword">out</span> newPosition, <span class="keyword">out</span> newVelocity);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We are here going to experiment with several integration methods, so create a new script called IntegrationMethods where we can store all of them. The first one is Backward Euler.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IntegrationMethods</span> : <span class="title">MonoBehaviour</span> </div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BackwardEuler</span>(<span class="params"></span></span></div><div class="line">		<span class="keyword">float</span> h,</div><div class="line">		Vector3 currentPosition,</div><div class="line">		Vector3 currentVelocity,</div><div class="line">		<span class="keyword">out</span> Vector3 newPosition,</div><div class="line">		<span class="keyword">out</span> Vector3 newVelocity)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//Init acceleration</span></div><div class="line">		<span class="comment">//Gravity</span></div><div class="line">		Vector3 acceleartionFactor = Physics.gravity;</div><div class="line"></div><div class="line">		<span class="comment">//Main algorithm</span></div><div class="line">		newVelocity = currentVelocity + h * acceleartionFactor;</div><div class="line"></div><div class="line">		newPosition = currentPosition + h * newVelocity;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If you now press play you should see a nice trajectory line from the turret towards the target. And the bullets fired from the turret should follow that path.</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-path-backward-euler.png" alt="How the trajectory path looks like with Backward Euler"></p>
<p>But if you move the target as little as 40 meters away from the turret, you will se that the trajectory line is not crossing the center of the target, and neither are the bullets. They are still hitting the box, but as we move the box further away from the turret, the accuracy will continue to fall. And that is not good enough if we want realistic bullets.</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-accuracy-backward-euler.png" alt="Bullet accuracy with Backward Euler"></p>
<p>You can change the time step value h to a smaller value, which will improve the accuracy of the line, but the accuracy will not be nearly 100 percent as good as we want it. Also, if you decrease the time step h to a too small value, you will get rounding erros that will decrease the accuracy as if you had a large h. <strong>So h can’t be neither too small nor too large</strong>. h has to be “lagom” as we say in Sweden. And how do we increase the accuracy of the bullets? That is the topic of the next part.</p>
<h2 id="Improve-precision"><a href="#Improve-precision" class="headerlink" title="Improve precision"></a>Improve precision</h2><p>In this part of the tutorial you will learn how to improve the accuracy of the trajectory line by using another integration method. You will also learn how to build your own physics engine with these integration methods so we can improve the accuracy of the bullets.</p>
<h3 id="Part-1-Different-integration-methods"><a href="#Part-1-Different-integration-methods" class="headerlink" title="Part 1. Different integration methods"></a>Part 1. Different integration methods</h3><p>To improve the accuracy you need another better integration method. The first one we are going to add is <a href="https://en.wikipedia.org/wiki/Euler_method" target="_blank" rel="external">Euler Forward</a>, which is very similar to Backward Euler. The main difference is that it is much easier to add external forces that might affect the bullet if you are using Euler Forward because of how the methods work. If you are using Backward Euler you have to figure out the forces in the next time step and not this time step, which may be more complicated. If you are using Euler Forward you can use the current values. The drawback is that Euler Forward is not matching Unity’s physics engine. Anyway, add the method EulerForward() to our collection of integration methods. Then change which of the integration method you are using in the TutorialBallistics script and observe the result.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Euler's method - one iteration</span></div><div class="line"><span class="comment">//Will not match Unity's physics engine</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">EulerForward</span>(<span class="params"></span></span></div><div class="line">	<span class="keyword">float</span> h,</div><div class="line">	Vector3 currentPosition,</div><div class="line">	Vector3 currentVelocity,</div><div class="line">	<span class="keyword">out</span> Vector3 newPosition,</div><div class="line">	<span class="keyword">out</span> Vector3 newVelocity)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//Init acceleration</span></div><div class="line">	<span class="comment">//Gravity</span></div><div class="line">	Vector3 acceleartionFactor = Physics.gravity;</div><div class="line">	<span class="comment">//acceleartionFactor += CalculateDrag(currentVelocity);</span></div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//Init velocity</span></div><div class="line">	<span class="comment">//Current velocity</span></div><div class="line">	Vector3 velocityFactor = currentVelocity;</div><div class="line">	<span class="comment">//Wind velocity</span></div><div class="line">	<span class="comment">//velocityFactor += new Vector3(2f, 0f, 3f);</span></div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="comment">//Main algorithm</span></div><div class="line">	<span class="comment">//</span></div><div class="line">	newPosition = currentPosition + h * velocityFactor;</div><div class="line"></div><div class="line">	newVelocity = currentVelocity + h * acceleartionFactor;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You will notice that Euler Forward is overshooting the target in a similar way as Backward Euler was undershooting the target.</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-accuracy-euler-forward.png" alt="Bullet accuracy Euler Forward"></p>
<p>So we need a better integration method. Another integration method is Heun’s method, which is using Euler Forward but is adding another step. It looks like this:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Heun's method - one iteration</span></div><div class="line"><span class="comment">//Will give a better result than Euler forward, but will not match Unity's physics engine</span></div><div class="line"><span class="comment">//so the bullets also have to use Heuns method</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Heuns</span>(<span class="params"></span></span></div><div class="line">	<span class="keyword">float</span> h,</div><div class="line">	Vector3 currentPosition,</div><div class="line">	Vector3 currentVelocity,</div><div class="line">	<span class="keyword">out</span> Vector3 newPosition,</div><div class="line">	<span class="keyword">out</span> Vector3 newVelocity)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//Init acceleration</span></div><div class="line">	<span class="comment">//Gravity</span></div><div class="line">	Vector3 acceleartionFactorEuler = Physics.gravity;</div><div class="line">	Vector3 acceleartionFactorHeun = Physics.gravity;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//Init velocity</span></div><div class="line">	<span class="comment">//Current velocity</span></div><div class="line">	Vector3 velocityFactor = currentVelocity;</div><div class="line">	<span class="comment">//Wind velocity</span></div><div class="line">	<span class="comment">//velocityFactor += new Vector3(2f, 0f, 3f);</span></div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="comment">//Main algorithm</span></div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="comment">//Euler forward</span></div><div class="line">	Vector3 pos_E = currentPosition + h * velocityFactor;</div><div class="line"></div><div class="line">	<span class="comment">//acceleartionFactorEuler += CalculateDrag(currentVelocity);</span></div><div class="line"></div><div class="line">	Vector3 vel_E = currentVelocity + h * acceleartionFactorEuler;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//Heuns method</span></div><div class="line">	Vector3 pos_H = currentPosition + h * <span class="number">0.5</span>f * (velocityFactor + vel_E);</div><div class="line"></div><div class="line">	<span class="comment">//acceleartionFactorHeun += CalculateDrag(vel_E);</span></div><div class="line"></div><div class="line">	Vector3 vel_H = currentVelocity + h * <span class="number">0.5</span>f * (acceleartionFactorEuler + acceleartionFactorHeun);</div><div class="line"></div><div class="line"></div><div class="line">	newPosition = pos_H;</div><div class="line">	newVelocity = vel_H;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If you now press play you will see something beautiful. The trajectory line goes straight through the target point we are aiming at.</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-accuracy-heuns-method.png" alt="Bullet accuracy Heuns Method"></p>
<p>Heun’s method is actually a simplified version of <a href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods" target="_blank" rel="external">Runge Kutta’s method</a>, which is another method you could add to the collection. I’ve tested to add it and it gives the same result as Heun’s method in this environment. Another integration method used when simulating bullets is <a href="https://en.wikiversity.org/wiki/Adams-bashforth_and_Adams-moulton_methods" target="_blank" rel="external">Adams-Bashforth</a>, but I haven’t tested it because Heun’s method is fast and accurate.</p>
<h3 id="Part-2-Improving-the-bullets"><a href="#Part-2-Improving-the-bullets" class="headerlink" title="Part 2. Improving the bullets"></a>Part 2. Improving the bullets</h3><p>But a sniper or an artillery officer will not care if the simulated trajectory line goes through the target. To improve the bullets we are going to use Heun’s method in a similar way as when we drew the trajectory line. The difference is that we can’t change the time step h. If you’ve ever wondered why you have to place everything in Unity that’s using physics in FixedUpdate() and not in Update(), the reason is this time step. It can’t be too small nor too large and should be constant. That’s why we are using Time.fixedDeltaTime as the time step h.</p>
<p>To improve the bullets you have to remove the RigidBody from it and replace it with a script called TutorialBullet. Also give the target a Tag called “Target” so we can detect if a bullet hit the target. To do that we fire a raycast every update from the last position to the new position as calculated by an integration method, and see if we have hit something. We also destroy the bullet if it falls below a certain level.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TutorialBullet</span> : <span class="title">MonoBehaviour</span></div><div class="line">&#123;    </div><div class="line">    <span class="keyword">public</span> Vector3 currentPosition;</div><div class="line">    <span class="keyword">public</span> Vector3 currentVelocity;</div><div class="line"></div><div class="line">    Vector3 newPosition = Vector3.zero;</div><div class="line">    Vector3 newVelocity = Vector3.zero;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        currentPosition = transform.position;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        DestroyBullet();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">FixedUpdate</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        MoveBullet();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//Did we hit a target</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">CheckHit</span>(<span class="params"></span>) </span></div><div class="line">    &#123;</div><div class="line">        Vector3 fireDirection = (newPosition - currentPosition).normalized;</div><div class="line">        <span class="keyword">float</span> fireDistance = Vector3.Distance(newPosition, currentPosition);</div><div class="line"></div><div class="line">        RaycastHit hit;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (Physics.Raycast(currentPosition, fireDirection, <span class="keyword">out</span> hit, fireDistance))</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (hit.collider.CompareTag(<span class="string">"Target"</span>))</div><div class="line">            &#123;</div><div class="line">                Debug.Log(<span class="string">"Hit target!"</span>);</div><div class="line">                <span class="comment">//Destroy(gameObject);</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">MoveBullet</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//Use an integration method to calculate the new position of the bullet</span></div><div class="line">        <span class="keyword">float</span> h = Time.fixedDeltaTime;</div><div class="line">        TutorialBallistics.CurrentIntegrationMethod(h, currentPosition, currentVelocity, <span class="keyword">out</span> newPosition, <span class="keyword">out</span> newVelocity);</div><div class="line"></div><div class="line">        <span class="comment">//First we need these coordinates to check if we have hit something</span></div><div class="line">        CheckHit();</div><div class="line"></div><div class="line">        currentPosition = newPosition;</div><div class="line">        currentVelocity = newVelocity;</div><div class="line"></div><div class="line">        <span class="comment">//Add the new position to the bullet</span></div><div class="line">        transform.position = currentPosition;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">DestroyBullet</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (transform.position.y &lt; <span class="number">-30</span>f)</div><div class="line">        &#123;</div><div class="line">            Destroy(gameObject);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You also need to change one line in the TutorialFireBullets script. Because we have removed the RigidBody from the bullet and replaced it with our own integration method, we need to add the velocity the bullet has at time zero.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> IEnumerator <span class="title">FireBullet</span>(<span class="params"></span>) </span></div><div class="line">&#123;        </div><div class="line">	<span class="keyword">while</span> (<span class="literal">true</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//Create a new bullet</span></div><div class="line">		GameObject newBullet = Instantiate(bulletObj, transform.position, transform.rotation) <span class="keyword">as</span> GameObject;</div><div class="line"></div><div class="line">		<span class="comment">//Parent it to get a less messy workspace</span></div><div class="line">		newBullet.transform.parent = bulletParent;</div><div class="line"></div><div class="line">		<span class="comment">//Add velocity to the non-physics bullet</span></div><div class="line">		newBullet.GetComponent&lt;TutorialBullet&gt;().currentVelocity = TutorialBallistics.bulletSpeed * transform.forward;</div><div class="line"></div><div class="line">		<span class="comment">//Add velocity to the bullet with a rigidbody</span></div><div class="line">		<span class="comment">//newBullet.GetComponent&lt;Rigidbody&gt;().velocity = TutorialBallistics.bulletSpeed * transform.forward;</span></div><div class="line"></div><div class="line">		<span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">2</span>f</span>)</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>If you now press play you will see that the bullets are also hitting the center of the target. Success!</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-accuracy-heuns-method-2.png" alt="Bullet accuracy with Heuns Method"></p>
<h2 id="Add-realism"><a href="#Add-realism" class="headerlink" title="Add realism"></a>Add realism</h2><p>In this section we will add factors that will affect the bullet, such as wind and drag.</p>
<h3 id="Part-1-Wind"><a href="#Part-1-Wind" class="headerlink" title="Part 1. Wind"></a>Part 1. Wind</h3><p>What you need to know if you are going to add realism to the bullet in Heun’s method is to calculate the acceleration or velocity with the correct time. Gravity was a constant acceleration and isn’t dependent on velocity or position, so we didn’t need to care about it when we added gravity. If the wind is constant, we can just add it in the same way as we added gravity. So just uncomment the line “velocityFactor += new Vector3(2f, 0f, 3f);” where the vector is whatever wind you want.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Heun's method - one iteration</span></div><div class="line"><span class="comment">//Will give a better result than Euler forward, but will not match Unity's physics engine</span></div><div class="line"><span class="comment">//so the bullets also have to use Heuns method</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Heuns</span>(<span class="params"></span></span></div><div class="line">	<span class="keyword">float</span> h,</div><div class="line">	Vector3 currentPosition,</div><div class="line">	Vector3 currentVelocity,</div><div class="line">	<span class="keyword">out</span> Vector3 newPosition,</div><div class="line">	<span class="keyword">out</span> Vector3 newVelocity)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//Init acceleration</span></div><div class="line">	<span class="comment">//Gravity</span></div><div class="line">	Vector3 acceleartionFactorEuler = Physics.gravity;</div><div class="line">	Vector3 acceleartionFactorHeun = Physics.gravity;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//Init velocity</span></div><div class="line">	<span class="comment">//Current velocity</span></div><div class="line">	Vector3 velocityFactor = currentVelocity;</div><div class="line">	<span class="comment">//Wind velocity</span></div><div class="line">	velocityFactor += <span class="keyword">new</span> Vector3(<span class="number">2</span>f, <span class="number">0</span>f, <span class="number">3</span>f);</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="comment">//Main algorithm</span></div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="comment">//Euler forward</span></div><div class="line">	Vector3 pos_E = currentPosition + h * velocityFactor;</div><div class="line"></div><div class="line">	<span class="comment">//acceleartionFactorEuler += BulletPhysics.CalculateDrag(currentVelocity);</span></div><div class="line"></div><div class="line">	Vector3 vel_E = currentVelocity + h * acceleartionFactorEuler;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//Heuns method</span></div><div class="line">	Vector3 pos_H = currentPosition + h * <span class="number">0.5</span>f * (velocityFactor + vel_E);</div><div class="line"></div><div class="line">	<span class="comment">//acceleartionFactorHeun += BulletPhysics.CalculateDrag(vel_E);</span></div><div class="line"></div><div class="line">	Vector3 vel_H = currentVelocity + h * <span class="number">0.5</span>f * (acceleartionFactorEuler + acceleartionFactorHeun);</div><div class="line"></div><div class="line"></div><div class="line">	newPosition = pos_H;</div><div class="line">	newVelocity = vel_H;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Part-2-Drag"><a href="#Part-2-Drag" class="headerlink" title="Part 2. Drag"></a>Part 2. Drag</h3><p>Drag force is more complicated to add compared with the wind, because the drag is dependent of the bullet’s velocity. So we have to calculate the acceleration from drag 2 times.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Heun's method - one iteration</span></div><div class="line"><span class="comment">//Will give a better result than Euler forward, but will not match Unity's physics engine</span></div><div class="line"><span class="comment">//so the bullets also have to use Heuns method</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Heuns</span>(<span class="params"></span></span></div><div class="line">	<span class="keyword">float</span> h,</div><div class="line">	Vector3 currentPosition,</div><div class="line">	Vector3 currentVelocity,</div><div class="line">	<span class="keyword">out</span> Vector3 newPosition,</div><div class="line">	<span class="keyword">out</span> Vector3 newVelocity)</div><div class="line">&#123;</div><div class="line">	<span class="comment">//Init acceleration</span></div><div class="line">	<span class="comment">//Gravity</span></div><div class="line">	Vector3 acceleartionFactorEuler = Physics.gravity;</div><div class="line">	Vector3 acceleartionFactorHeun = Physics.gravity;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//Init velocity</span></div><div class="line">	<span class="comment">//Current velocity</span></div><div class="line">	Vector3 velocityFactor = currentVelocity;</div><div class="line">	<span class="comment">//Wind velocity</span></div><div class="line">	velocityFactor += <span class="keyword">new</span> Vector3(<span class="number">2</span>f, <span class="number">0</span>f, <span class="number">3</span>f);</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="comment">//Main algorithm</span></div><div class="line">	<span class="comment">//</span></div><div class="line">	<span class="comment">//Euler forward</span></div><div class="line">	Vector3 pos_E = currentPosition + h * velocityFactor;</div><div class="line"></div><div class="line">	acceleartionFactorEuler += BulletPhysics.CalculateDrag(currentVelocity);</div><div class="line"></div><div class="line">	Vector3 vel_E = currentVelocity + h * acceleartionFactorEuler;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">//Heuns method</span></div><div class="line">	Vector3 pos_H = currentPosition + h * <span class="number">0.5</span>f * (velocityFactor + vel_E);</div><div class="line"></div><div class="line">	acceleartionFactorHeun += BulletPhysics.CalculateDrag(vel_E);</div><div class="line"></div><div class="line">	Vector3 vel_H = currentVelocity + h * <span class="number">0.5</span>f * (acceleartionFactorEuler + acceleartionFactorHeun);</div><div class="line"></div><div class="line"></div><div class="line">	newPosition = pos_H;</div><div class="line">	newVelocity = vel_H;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>You should also create a new script called BulletPhysics where you can collect all methods that affect the bullets, and add a method that calculates drag. You should change these parameters, like mass and area, to fit your bullet.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BulletPhysics</span> : <span class="title">MonoBehaviour</span> </div><div class="line">&#123;</div><div class="line">    <span class="comment">//Calculate the bullet's drag's acceleration</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">CalculateDrag</span>(<span class="params">Vector3 velocityVec</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//F_drag = k * v^2 = m * a</span></div><div class="line">        <span class="comment">//k = 0.5 * C_d * rho * A </span></div><div class="line"></div><div class="line">        <span class="keyword">float</span> m = <span class="number">0.2</span>f; <span class="comment">// kg</span></div><div class="line">        <span class="keyword">float</span> C_d = <span class="number">0.5</span>f;</div><div class="line">        <span class="keyword">float</span> A = Mathf.PI * <span class="number">0.05</span>f * <span class="number">0.05</span>f; <span class="comment">// m^2</span></div><div class="line">        <span class="keyword">float</span> rho = <span class="number">1.225</span>f; <span class="comment">// kg/m3</span></div><div class="line"></div><div class="line">        <span class="keyword">float</span> k = <span class="number">0.5</span>f * C_d * rho * A;</div><div class="line"></div><div class="line">        <span class="keyword">float</span> vSqr = velocityVec.sqrMagnitude;</div><div class="line"></div><div class="line">        <span class="keyword">float</span> aDrag = (k * vSqr) / m;</div><div class="line"></div><div class="line">        <span class="comment">//Has to be in a direction opposite of the bullet's velocity vector</span></div><div class="line">        Vector3 dragVec = aDrag * velocityVec.normalized * <span class="number">-1</span>f;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> dragVec;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>That’s all of the external factors we are going to add for now. If you press play you will notice that the bullets are no longer hitting the target. The equation we used to calculate the angle is not working if we add drag and wind.</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/bullet-missing-target.png" alt="How the bullet misses the target if we add wind and drag"></p>
<h2 id="Add-sniper-rifle"><a href="#Add-sniper-rifle" class="headerlink" title="Add sniper rifle"></a>Add sniper rifle</h2><p>In this part of the tutorial you will learn how to add a sniper rifle that can zoom and fire realistic bullets</p>
<h3 id="Part-1-Preparations"><a href="#Part-1-Preparations" class="headerlink" title="Part 1. Preparations"></a>Part 1. Preparations</h3><p>First of all we need a sniper rifle, which in this case will consist of a scope, so go to Google and download your favorite scope image. I downloaded <a href="http://www.rodypolis.com/free-stuff.html" target="_blank" rel="external">this</a>. While you are googling, you should also find an image that we can use as a target. I downloaded <a href="http://www.turbosquid.com/FullPreview/Index.cfm/ID/439778" target="_blank" rel="external">Target for Archery</a>.</p>
<p>Then drag both of the images into Unity. The target texture should be a Texture and you should add it to a material. Then create 2 cubes with scale 2. Name one Target and the other Target mirror. We will need a mirror of the target to easier see what we hit so we don’t have to run to the target and back again each time we have fired a bullet. Add the target material to both cubes.</p>
<p>The scope image should be a Sprite (2D and UI). To add the scope image to the scene, right-click -&gt; UI -&gt; Image, and add the scope as the source image. I also had to scale it 3 times so it fits the entire screen. Also create a cube at the center of the scene so you have somewhere to fire from. Also create some kind of arrow from 2 cubes so we can show in which direction the wind is coming from. Also add Unity’s first person controller. When you are done it should look like this:</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/sniper-start-scene.png" alt="Sniper start scene"></p>
<h3 id="Part-2-Create-a-sniper-rifle"><a href="#Part-2-Create-a-sniper-rifle" class="headerlink" title="Part 2. Create a sniper rifle"></a>Part 2. Create a sniper rifle</h3><p>Create a script called SniperController and add the code below. The mainCamera is the camera attached to the first person controller, the sightImage is our sniper scope, the bulletObj is the bullet we are going to fire, and the targetObj and mirrorTargetObj are the targets we created. The hitMarker is a simple sphere we will add to the position where the bullet hit. So create a sphere, scale it to (0.1, 0.1, 0.1) and add it as a prefab.</p>
<p>We need the “using UnityStandardAssets.Characters.FirstPerson;” so we can change the sensitivity of the mouse when we have zoomed the camera (scope). So we need to access the MouseLook, which is a part of Unity’s first person controller. This might be different depending on the Unity version you are using, but you will be able to complete the tutorial if you are not changing the sensitivity. It will just be more difficult to aim.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"><span class="keyword">using</span> UnityStandardAssets.Characters.FirstPerson;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SniperController</span> : <span class="title">MonoBehaviour</span> </div><div class="line">&#123;</div><div class="line">    <span class="comment">//Drags</span></div><div class="line">    <span class="keyword">public</span> Camera mainCamera;</div><div class="line">    <span class="keyword">public</span> GameObject sightImage;</div><div class="line">    <span class="keyword">public</span> GameObject bulletObj;</div><div class="line">    <span class="keyword">public</span> Transform targetObj;</div><div class="line">    <span class="keyword">public</span> Transform mirrorTargetObj;</div><div class="line">    <span class="keyword">public</span> GameObject hitMarker;</div><div class="line">    </div><div class="line">    <span class="comment">//The bullet's initial speed</span></div><div class="line">    <span class="comment">//Sniper rifle</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">float</span> bulletSpeed = <span class="number">850</span>f;</div><div class="line"></div><div class="line">    <span class="comment">//Need the initial camera FOV so we can zoom</span></div><div class="line">    <span class="keyword">float</span> initialFOV;</div><div class="line">    <span class="comment">//To change the zoom</span></div><div class="line">    <span class="keyword">int</span> currentZoom = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="comment">//To change sensitivity when zoomed</span></div><div class="line">    MouseLook mouseLook;</div><div class="line">    <span class="keyword">float</span> standardSensitivity;</div><div class="line">    <span class="keyword">float</span> zoomSensitivity = <span class="number">0.1</span>f;</div><div class="line"></div><div class="line">    <span class="keyword">bool</span> canFire = <span class="literal">true</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Vector3 windSpeed = <span class="keyword">new</span> Vector3(<span class="number">2</span>f, <span class="number">0</span>f, <span class="number">3</span>f);</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>) </span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//Lock and hide the mouse cursor </span></div><div class="line">        UnityEngine.Cursor.visible = <span class="literal">false</span>;</div><div class="line">        Cursor.lockState = CursorLockMode.Locked;</div><div class="line"></div><div class="line">        initialFOV = mainCamera.fieldOfView;</div><div class="line"></div><div class="line">        mouseLook = GetComponent&lt;RigidbodyFirstPersonController&gt;().mouseLook;</div><div class="line"></div><div class="line">        standardSensitivity = mouseLook.XSensitivity;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>) </span></div><div class="line">    &#123;        </div><div class="line">        ZoomSight();</div><div class="line"></div><div class="line">        FireBullet();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Now we will zoom the scope. The sniper rifle I found on Wikipedia can zoom between 3 and 12 times. So add the method ZoomSight(). The basic idea is that we are deactivating the scope image when we are not zooming, we zoom in and out with the mouse wheel, and then we add the new FOV with zoom to the camera.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//The sniper rifle can zoom between 3 and 12 times</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ZoomSight</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//Remove the scope sight if we are not zooming</span></div><div class="line">	<span class="keyword">if</span> (currentZoom == <span class="number">1</span>) </div><div class="line">	&#123;</div><div class="line">		sightImage.SetActive(<span class="literal">false</span>);</div><div class="line"></div><div class="line">		<span class="comment">//Change sensitivity</span></div><div class="line">		mouseLook.XSensitivity = standardSensitivity;</div><div class="line">		mouseLook.YSensitivity = standardSensitivity;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span> </div><div class="line">	&#123;</div><div class="line">		sightImage.SetActive(<span class="literal">true</span>);</div><div class="line"></div><div class="line">		<span class="comment">//Change sensitivity</span></div><div class="line">		mouseLook.XSensitivity = zoomSensitivity;</div><div class="line">		mouseLook.YSensitivity = zoomSensitivity;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//Zoom with mouse wheel</span></div><div class="line">	<span class="keyword">if</span> (Input.GetAxis(<span class="string">"Mouse ScrollWheel"</span>) &gt; <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		currentZoom += <span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">else</span> <span class="title">if</span> (<span class="params">Input.GetAxis(<span class="string">"Mouse ScrollWheel"</span></span>) &lt; 0)</span></div><div class="line">	&#123;</div><div class="line">		currentZoom -= <span class="number">1</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//Clamp zoom</span></div><div class="line">	<span class="comment">//Keep it between 1 and 11, then add 1 when zoom because zoom is between 3 and 12 times</span></div><div class="line">	currentZoom = Mathf.Clamp(currentZoom, <span class="number">1</span>, <span class="number">11</span>);</div><div class="line"></div><div class="line">	<span class="comment">//No zoom</span></div><div class="line">	<span class="keyword">if</span> (currentZoom == <span class="number">1</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//If the zoom is 6x, then the FOV is FOV / 6 (according to unscientific research on Internet)</span></div><div class="line">		mainCamera.fieldOfView = initialFOV / (<span class="keyword">float</span>)currentZoom;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//Zoom the sight</span></div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		mainCamera.fieldOfView = initialFOV / ((<span class="keyword">float</span>)currentZoom + <span class="number">1</span>f);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Let’s fire the sniper rifle, so add the method FireBullet(). The problem I had here was that when we aim high, the mouse ends up outside of the webplayer even though we locked it in the beginning. I tried to find a solution, but found that several other people had the same problem and no good solution. It will probably work if you are in full-screen, which might be a good idea because the target will be really small when it’s far away.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">FireBullet</span>(<span class="params"></span>) </span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//Sometimes when we move the mouse is really high in the webplayer, so the mouse cursor ends up outside</span></div><div class="line">	<span class="comment">//of the webplayer so we cant fire, despite locking the cursor, so add alternative fire button</span></div><div class="line">	<span class="keyword">if</span> ((Input.GetMouseButtonDown(<span class="number">0</span>) || Input.GetKeyDown(KeyCode.F)) &amp;&amp; canFire)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//Create a new bullet</span></div><div class="line">		GameObject newBullet = Instantiate(bulletObj, mainCamera.transform.position, mainCamera.transform.rotation) <span class="keyword">as</span> GameObject;</div><div class="line"></div><div class="line">		<span class="comment">//Give it speed</span></div><div class="line">		newBullet.GetComponent&lt;TutorialBullet&gt;().currentVelocity = bulletSpeed * mainCamera.transform.forward;</div><div class="line"></div><div class="line">		canFire = <span class="literal">false</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//Has to release the trigger to fire again</span></div><div class="line">	<span class="keyword">if</span> (Input.GetMouseButtonUp(<span class="number">0</span>) || Input.GetKeyUp(KeyCode.F))</div><div class="line">	&#123;</div><div class="line">		canFire = <span class="literal">true</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We also need to change a few lines in the TutorialBullet script. By the way, don’t forget to tag the target cubes you created as “Target,” and add the following lines to TutorialBullet:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (hit.collider.CompareTag(<span class="string">"Target"</span>))</div><div class="line">&#123;</div><div class="line">	Debug.Log(<span class="string">"Hit target!"</span>);</div><div class="line">	</div><div class="line">	<span class="comment">//Destroy the bullet</span></div><div class="line">	Destroy(gameObject);</div><div class="line"></div><div class="line">	<span class="comment">//Add marker where we hit target</span></div><div class="line">	GameObject.FindGameObjectWithTag(<span class="string">"Player"</span>).GetComponent&lt;SniperController&gt;().AddMarker(hit.point);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>While working with the bullet, you should also add a Trail Renderer component to the bullet to make it easier to see the fast bullet. It should have a time of 0.5, a start width of 0.2 and an end width of 0.05, or whatever you think looks good. Also give the Trail Renderer an unlit material or it will be pink!</p>
<p>You also need to add another method in SniperController. As I said before, the idea is to mirror the position where we hit the cube that’s closer to the position where we fire bullets, so we don’t need to spend time running to see where we hit the real target. To make this work we have to translate the coordinate where we hit to the coordinate of the cube that’s mirroring the hits.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Add marker where we hit target</span></div><div class="line"><span class="comment">//Called from the bullet script</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddMarker</span>(<span class="params">Vector3 hitCoordinates</span>) </span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//Add a marker where we hit the target</span></div><div class="line">	Instantiate(hitMarker, hitCoordinates, Quaternion.identity);</div><div class="line"></div><div class="line">	<span class="comment">//The coordinates of the hit in localPosition of the target</span></div><div class="line">	Vector3 localHitCoordinates = targetObj.InverseTransformPoint(hitCoordinates);</div><div class="line"></div><div class="line">	<span class="comment">//The global coordinates of the hit but in relation to the mirror target</span></div><div class="line">	<span class="comment">//The marker has the same local position in relation to both the target and the mirror</span></div><div class="line">	Vector3 globalMirrorHit = mirrorTargetObj.transform.TransformPoint(localHitCoordinates);</div><div class="line"></div><div class="line">	<span class="comment">//Add another marker</span></div><div class="line">	Instantiate(hitMarker, globalMirrorHit, Quaternion.identity);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Finally, you need to add a script called Wind where we set the rotation of the object that is showing in which way the wind is coming from. It will make it easier to hit the target. Also add the script to the object showing the wind.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> UnityEngine;</div><div class="line"><span class="keyword">using</span> System.Collections;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Wind</span> : <span class="title">MonoBehaviour</span> </div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>) </span></div><div class="line">    &#123;</div><div class="line">        Vector3 windDirection = SniperController.windSpeed.normalized;</div><div class="line">        Quaternion rotation = Quaternion.LookRotation(windDirection);</div><div class="line">        transform.rotation = rotation;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Also change in the script called IterationMethods so the wind comes from the SniperController, so you only have to change the wind velocity in one place.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Wind velocity</span></div><div class="line">velocityFactor += SniperController.windSpeed;</div></pre></td></tr></table></figure>
<p>That’s it. Move the target to a z-coordinate of 300, and if you press play you should now be able to fire bullets.</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/sniper-final-scene-1.png" alt="Sniper final scene 1"></p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/sniper-final-scene-2.png" alt="Sniper final scene 2"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.habrador.com/tutorials/unity-realistic-bullets/" target="_blank" rel="external">Make a realistic bullets in Unity with C#</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tospan.me/2017/02/05/Unity-Make-a-realistic-bullets/" data-id="ciyu4ntg400292tvwqz3hdiln" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity/">Unity</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/02/05/Unity-Dynamic-Mesh-Combining/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Unity Dynamic Mesh Combining
        
      </div>
    </a>
  
  
    <a href="/2017/02/05/Generate-random-numbers-in-Unity/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Generate random numbers in Unity</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity/">Unity</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Basics/">Basics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Games/">Games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Geometry/">Geometry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linear-Algebra/">Linear Algebra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/">Math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numerical-Analysis/">Numerical Analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/">Unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/default/">default</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Basics/" style="font-size: 15px;">Basics</a> <a href="/tags/C/" style="font-size: 13.33px;">C#</a> <a href="/tags/Games/" style="font-size: 10px;">Games</a> <a href="/tags/Geometry/" style="font-size: 11.67px;">Geometry</a> <a href="/tags/Linear-Algebra/" style="font-size: 16.67px;">Linear Algebra</a> <a href="/tags/Math/" style="font-size: 18.33px;">Math</a> <a href="/tags/Numerical-Analysis/" style="font-size: 10px;">Numerical Analysis</a> <a href="/tags/Unity/" style="font-size: 20px;">Unity</a> <a href="/tags/default/" style="font-size: 10px;">default</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/02/06/Math-3D/">3D数学</a>
          </li>
        
          <li>
            <a href="/2017/02/06/Unity-Engine-Core-Concept/">Unity引擎重要概念</a>
          </li>
        
          <li>
            <a href="/2017/02/06/Unity-Scripting-2D-Code-Snippet/">Unity编程 2D脚本常用代码集合</a>
          </li>
        
          <li>
            <a href="/2017/02/06/Unity-Scripting-Core/">Unity编程要点</a>
          </li>
        
          <li>
            <a href="/2017/02/06/C-Sharp-Essential/">C#要点</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 To Span<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>