<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>生成随机数 | 吐司片的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I’ve recently set out on the task to learn everything about shaders in Unity. One of the problems I encountered was how to generate random numbers in a shader? The problem is that shaders don’t have a">
<meta property="og:type" content="article">
<meta property="og:title" content="生成随机数">
<meta property="og:url" content="http://tospan.me/2017/02/05/Generate-random-numbers/index.html">
<meta property="og:site_name" content="吐司片的博客">
<meta property="og:description" content="I’ve recently set out on the task to learn everything about shaders in Unity. One of the problems I encountered was how to generate random numbers in a shader? The problem is that shaders don’t have a">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/dilbert-randomness.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/random-numbers-middle-square.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/random-numbers-middle-square-more-iterations.png">
<meta property="og:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/random-numbers-linear-congruential-generator.png">
<meta property="og:updated_time" content="2017-02-05T05:51:47.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="生成随机数">
<meta name="twitter:description" content="I’ve recently set out on the task to learn everything about shaders in Unity. One of the problems I encountered was how to generate random numbers in a shader? The problem is that shaders don’t have a">
<meta name="twitter:image" content="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/dilbert-randomness.gif">
  
    <link rel="alternate" href="/atom.xml" title="吐司片的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">吐司片的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Work hard, play hard.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://tospan.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Generate-random-numbers" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/05/Generate-random-numbers/" class="article-date">
  <time datetime="2017-02-05T05:51:47.000Z" itemprop="datePublished">2017-02-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Game-Development/">Game Development</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      生成随机数
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ve recently set out on the task to learn everything about shaders in Unity. One of the problems I encountered was how to generate random numbers in a shader? The problem is that shaders don’t have a built-in function to generate random numbers. Unity’s built in function, at least if you are using C#, is called Random.Range(), and it will give you a random number. But there’s no similar function if you are programming a shader and need random numbers, so you have to come up with another solution.</p>
<a id="more"></a>
<h2 id="Introduction-to-random-numbers"><a href="#Introduction-to-random-numbers" class="headerlink" title="Introduction to random numbers"></a>Introduction to random numbers</h2><p>What are we doing here? We are going to generate random numbers with a so-called <strong>Random Number Generator (RNG)</strong>. According to <a href="https://en.wikipedia.org/wiki/Random_number_generation" target="_blank" rel="external">Wikipedia</a>, an RNG is “a computational or physical device designed to generate a sequence of numbers or symbols that cannot be reasonably predicted better than by a random chance.” This is actually more difficult than it first may sound. The reason is that it’s impossible, as far as humanity knows, to generate random numbers in a computer with an algorithm. So the world of random number generation is divided into two groups:</p>
<ol>
<li><p><strong>True random numbers generators (TRNG).</strong> These are really random numbers. Someone argued that you could generate these from cats walking on keyboards and detecting which keys are pressed. But you may actually be able to predict the “random” numbers if you know the size of the cat, so that’s not going to work. What you will need is some physical phenomenon that is expected to be random.</p>
<ul>
<li>The points in time at which a radioactive source decays are completely unpredictable.</li>
<li>Atmospheric noise, which is quite easy to pick up with a normal radio, is also considered random. <a href="https://www.random.org/" target="_blank" rel="external">Random.org</a> is generating randomness from atmospheric noise.</li>
<li>What about the background noise in a café? Maybe you can record that and see if it’s random?</li>
<li>What happens if you combine all sources?<br>Pseudo random number generators (PRNG). These are fake random numbers, so they are not entirely random because you are generating them with an algorithm. These numbers will work in many cases, but not in all. If you are visiting an online poker site, and you know the algorithm used to generate the “random” numbers, you can write a program that will predict the cards that are going to be dealt. So if you are running a poker site, you have to use a TRNG.<br>This tutorial is divided into the following sections:</li>
</ul>
</li>
<li><p>Generate random numbers in Unity with C#. In this section you will learn the basics of how to generate pseudo random numbers by writing your own algorithms. You will also learn how to visualize the result to see if the numbers appear to be random.</p>
</li>
<li>Generate random numbers with shader code. In this section you will learn how to get random numbers if you are writing a shader.</li>
</ol>
<h2 id="1-Generate-random-numbers-in-Unity-with-C"><a href="#1-Generate-random-numbers-in-Unity-with-C" class="headerlink" title="1. Generate random numbers in Unity with C"></a>1. Generate random numbers in Unity with C</h2><p>Generating pseudo random numbers in Unity is easy. This is how it works:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Random.InitState(<span class="number">12345</span>); <span class="comment">//This is the seed</span></div><div class="line"></div><div class="line">print(Random.Range(<span class="number">0</span>, <span class="number">10</span>)); <span class="comment">//returns 6 every time</span></div><div class="line">print(Random.Range(<span class="number">0</span>, <span class="number">10</span>)); <span class="comment">//returns 6 every time</span></div><div class="line">print(Random.Range(<span class="number">0</span>, <span class="number">10</span>)); <span class="comment">//returns 9 every time</span></div></pre></td></tr></table></figure>
<p>One of properties of a true random number is that you <strong>shouldn’t be able to find a pattern between the numbers</strong>. Another property of a true random number is that <strong>nobody should be able to reconstruct the sequence at a later time</strong>. But with pseudo random numbers you will be able to generate the same sequence of random numbers because you are using a so-called seed. You always need a seed to start the algorithm. If you are just writing Random.Range(0, 10), Unity is using some built-in seed to generate the number. This seed can come from different sources:</p>
<ul>
<li>From the system clock when the program is launched or when the game begins.</li>
<li>From the frequency of the user’s keystrokes or mouse movement when the program is launched or when the game begins.</li>
</ul>
<p>If you are using a known seed you can replicate whatever you have done. I recall a <a href="https://www.kaggle.com/" target="_blank" rel="external">Kaggle competition</a> where you are competing in who can build the best model to predict something from data. Someone came up with the winning model and this model used pseudo random numbers. But he/she couldn’t replicate the winning model because when the person tried to again run the model, the new random numbers resulted in a worse model. If that person had used a known seed, the model would have generated the same random numbers as in the winning model. In the end someone else won the money. So always use a known seed!</p>
<p>What the pseudo random number generators have in common is that they are a special type of function known as a <a href="https://en.wikipedia.org/wiki/Recurrence_relation" target="_blank" rel="external">recurrence relation</a>. This means that a the value at a given time step n is dependent on values from previous steps. The simplest example is the Fibonacci series:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Generate random numbers with the Fibonacci series</span></div><div class="line"><span class="comment">//The seed should be 0, 1</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetRandomFibonacci</span>(<span class="params"><span class="keyword">int</span> xMinusOneSeed, <span class="keyword">int</span> xMinusTwoSeed</span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> xMinusOne = xMinusOneSeed;</div><div class="line"></div><div class="line">	<span class="keyword">int</span> xMinusTwo = xMinusTwoSeed;</div><div class="line"></div><div class="line">	<span class="comment">//The Fibonacci series is endless so we have to limit by using a modulus</span></div><div class="line">	<span class="keyword">int</span> m = <span class="keyword">int</span>.MaxValue;</div><div class="line"></div><div class="line">	<span class="keyword">string</span> allRandomNumbers = <span class="string">""</span>;</div><div class="line"></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//x_n = x_(n-1) + x_(n-2)</span></div><div class="line"></div><div class="line">		<span class="comment">//Numbers in C# wrap, so if the sum is larger than the possible value, it begins</span></div><div class="line">		<span class="comment">//from the smallest possible value, so we have to check if the sum is &lt; 0</span></div><div class="line">		<span class="keyword">int</span> sum = xMinusOne + xMinusTwo;</div><div class="line"></div><div class="line">		<span class="keyword">if</span> (xMinusOne + xMinusTwo &lt; <span class="number">0</span>)</div><div class="line">		&#123;</div><div class="line">			sum = <span class="keyword">int</span>.MaxValue;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">int</span> randomNumber = sum % m;</div><div class="line"></div><div class="line">		allRandomNumbers += randomNumber.ToString() + <span class="string">" "</span>;</div><div class="line"></div><div class="line">		xMinusTwo = xMinusOne;</div><div class="line">		xMinusOne = randomNumber;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	print(allRandomNumbers);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="How-can-we-test-that-numbers-generated-by-a-PRNG-are-random"><a href="#How-can-we-test-that-numbers-generated-by-a-PRNG-are-random" class="headerlink" title="How can we test that numbers generated by a PRNG are random?"></a>How can we test that numbers generated by a PRNG are random?</h3><p>The Fibonacci series is a useless random number generator because the sequence is 0, 1, 1, 2, 3, 5, 8, 13, 21, … So someone who knows the Fibonacci series can figure out the next number. Moreover, the sequence is stabilizing and repeats the sequence 0, 1836311903, 1836311903, 0, 1836311903, … over and over again. This is called the random generator’s <strong>period</strong>, which is how long it takes before the numbers starts repeating. So we will need something better because the period is way too low, but the Fibonacci series is a good example of the basic ideas behind how to generate random numbers.</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/dilbert-randomness.gif" alt="Dilbert on randomness"></p>
<p>How can we test that the pseudo random number generator is producing random numbers? The easiest way is to visualize the random numbers on the screen in the form of a grid where each square is a gray-scale color. So we need a way to convert from whatever random value we have to a range between 0 and 1. This method is doing exactly that:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Convert to the correct range</span></div><div class="line"><span class="comment">//http://stackoverflow.com/questions/929103/convert-a-number-range-to-another-range-maintaining-ratio</span></div><div class="line"><span class="comment">//originalNumber is the number we want to convert</span></div><div class="line"><span class="comment">//oldMin and oldMax is the range of the random numbers we have</span></div><div class="line"><span class="comment">//newMin and newMax is the range we want, such as 0, 1</span></div><div class="line"><span class="function"><span class="keyword">float</span> <span class="title">ConvertToRange</span>(<span class="params"><span class="keyword">float</span> originalNumber, <span class="keyword">float</span> oldMin, <span class="keyword">float</span> oldMax, <span class="keyword">float</span> newMin, <span class="keyword">float</span> newMax</span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">float</span> oldRange = oldMax - oldMin;</div><div class="line">	<span class="keyword">float</span> newRange = newMax - newMin;</div><div class="line"></div><div class="line">	<span class="keyword">float</span> convertedNumber = (((originalNumber - oldMin) * newRange) / oldRange) + newMin;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> convertedNumber;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>We humans are really good at spotting patterns, and visualisation allows us to use our eyes and brain to try to see if the pattern is random. This is not the best method, but it’s the easiest and fastest method. A more complicated but better way is the <a href="https://en.wikipedia.org/wiki/Diehard_tests" target="_blank" rel="external">Diehard test</a>, which is a battery of statistical tests for measuring the quality of a random number generator.</p>
<p>To be able to visualize the random numbers on the screen you need to create a plane, give the plane a material with an Unlit/Texture shader and drag it to the script after you’ve added the following to the top of the script:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//A plane to which we will add a texture showing how random a random generator is</span></div><div class="line"><span class="keyword">public</span> Renderer textureRenderer;</div></pre></td></tr></table></figure>
<p>This method will generate the texture and add it to the material that’s added to the plane you just added:</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Display the noise on the screen for debugging</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">DrawRandomMap</span>(<span class="params"><span class="keyword">float</span>[] randomValues</span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//The random values are 1D, but we want to display them in a square</span></div><div class="line">	<span class="keyword">int</span> width = Mathf.FloorToInt(Mathf.Sqrt(randomValues.Length));</div><div class="line"></div><div class="line">	<span class="comment">//From random values to colors</span></div><div class="line">	Color[] colorMap = <span class="keyword">new</span> Color[width * width];</div><div class="line"></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt; width * width; x++)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//The colors are gray scale</span></div><div class="line">		colorMap[x] = Color.Lerp(Color.black, Color.white, randomValues[x]);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//Add the colors to the texture</span></div><div class="line">	Texture2D texture = <span class="keyword">new</span> Texture2D(width, width);</div><div class="line"></div><div class="line">	texture.SetPixels(colorMap);</div><div class="line"></div><div class="line">	<span class="comment">//Remove the blur from the texture</span></div><div class="line">	texture.filterMode = FilterMode.Point;</div><div class="line"></div><div class="line">	texture.wrapMode = TextureWrapMode.Clamp;</div><div class="line"></div><div class="line">	texture.Apply();</div><div class="line"></div><div class="line">	<span class="comment">//Add the texture to the material</span></div><div class="line">	textureRenderer.material.mainTexture = texture;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="What-are-some-pseudo-random-numbers-algorithms"><a href="#What-are-some-pseudo-random-numbers-algorithms" class="headerlink" title="What are some pseudo random numbers algorithms?"></a>What are some pseudo random numbers algorithms?</h3><p>What exactly is happening when we write Random.Range(0, 10) and get back a “random” integer in the range 0 to 10? The answer is that there’s some kind of algorithm that’s generating a number. I’m not sure what algorithm is used to generate Unity’s random numbers, but C#’s Random class is, according to the <a href="https://msdn.microsoft.com/en-us/library/system.random(v=vs.110" target="_blank" rel="external">documentation</a>.aspx), using an algorithm based on a modified version of <strong>Donald E. Knuth’s subtractive random number generator algorithm</strong>. So there’s more than one type of algorithm generating pseudo random numbers. If you study the area you will learn that the <strong>Mersenne Twister</strong> is considered the best pseudo random number generator.</p>
<p><strong>The Middle Square Method</strong>. Was suggested by no-one else than the famous mathematician John von Neumann himself. But even the sun has spots because the method is not a good method. The period is usually very short and it has some severe weaknesses, such as the output sequence almost always converging to zero. But it’s easy to implement. The basic idea is that you multiply the seed with itself, add 0s to the seed if it is shorter than the double of the amount of digits in the seed. Then you take the middle of this seed, and this is your random number. To generate another random number, you just use the random number you got as a seed.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Generate random numbers with the Middle Square Method</span></div><div class="line"><span class="comment">//https://www.youtube.com/watch?v=4sYawx70iP4&amp;index=2</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetRandomMiddleSquare</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="comment">//We cant use the regular int32, which max value is 2147483647</span></div><div class="line">	<span class="comment">//So we have to use long, which max value is 9,223,372,036,854,775,807</span></div><div class="line">	<span class="keyword">long</span> seed = <span class="number">5234567890</span>;</div><div class="line"></div><div class="line">	<span class="comment">//How many digits in the seed?</span></div><div class="line">	<span class="keyword">int</span> digits = seed.ToString().Length;</div><div class="line"></div><div class="line">	<span class="comment">//To display the random numbers when the loop is finished</span></div><div class="line">	<span class="keyword">string</span> allRandomNumbers = <span class="string">""</span>;</div><div class="line"></div><div class="line">	<span class="comment">//How many random numbers do we want to generate?</span></div><div class="line">	<span class="keyword">int</span> amountOfNumbers = <span class="number">1000</span>;</div><div class="line"></div><div class="line">	<span class="comment">//Array that will store the random numbers so we can display them</span></div><div class="line">	<span class="keyword">float</span>[] randomNumbers = <span class="keyword">new</span> <span class="keyword">float</span>[amountOfNumbers];</div><div class="line"></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; amountOfNumbers; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//Square the seed</span></div><div class="line">		<span class="keyword">long</span> seedSqr = seed * seed;</div><div class="line"></div><div class="line">		<span class="comment">//Make it a string</span></div><div class="line">		<span class="keyword">string</span> randomString = seedSqr.ToString();</div><div class="line"></div><div class="line">		<span class="comment">//If the string has less than digits * 2 characters, add zeros to the front of the string</span></div><div class="line">		<span class="keyword">while</span> (randomString.Length &lt; digits * <span class="number">2</span>)</div><div class="line">		&#123;</div><div class="line">			randomString = <span class="number">0</span> + randomString;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">//Get the middle characters of this string</span></div><div class="line">		<span class="keyword">int</span> start = Mathf.FloorToInt(digits / <span class="number">2</span>);</div><div class="line">		</div><div class="line">		<span class="keyword">string</span> middleCharacters = randomString.Substring(start, digits);</div><div class="line">	   </div><div class="line">		<span class="comment">//The next seed in the next loop is these middle characters</span></div><div class="line">		seed = <span class="keyword">long</span>.Parse(middleCharacters);</div><div class="line">		</div><div class="line">		<span class="comment">//If we want a float between 0 and 1 we divide the maximum number with 9999 if we have 4 digits</span></div><div class="line">		<span class="keyword">float</span> divisor = (Mathf.Pow(<span class="number">10</span>f, digits)) - <span class="number">1</span>f;</div><div class="line">		</div><div class="line">		<span class="comment">//Remove this line if you want to speed up the testing of the algorithm</span></div><div class="line">		allRandomNumbers += (seed / divisor) + <span class="string">" "</span>;</div><div class="line"></div><div class="line">		randomNumbers[i] = seed / divisor;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	print(allRandomNumbers);</div><div class="line"></div><div class="line">	DrawRandomMap(randomNumbers);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>This is how it looks like if we visualize the Middle Square Method. The result is actually good if you have a 10 digit seed. If the seed is like 5 digits, the algorithm stops generating new random numbers after just a few iterations.</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/random-numbers-middle-square.png" alt="Visualization of random numbers with the middle square method"><br>But if you are looping the algorithm 30000 times, you will se that it stops working:</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/random-numbers-middle-square-more-iterations.png" alt="Visualization of random numbers with the failing middle square method"></p>
<p><strong>The Linear Congruential Generator (LCG)</strong>. Is one of the oldest pseudo random number generators and is the most commonly taught and commonly used RNG, so it’s far more common than the Middle Square Method. It’s usually the basis for RNGs in most math libraries. If I’ve understood everything correctly, Donald E. Knuth’s subtractive random number generator algorithm, which is the algorithm probably used by Unity, is a Linear Congruential Generator. But the algorithm is far from perfect, so don’t use it in cryptographic applications.</p>
<p>In addition to the seed, the algorithm uses three values: m, a, and c. You can find examples of what those values have been in different implemenations of the algorithm on <a href="https://en.wikipedia.org/wiki/Linear_congruential_generator" target="_blank" rel="external">Wikipedia</a>.</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Generate random numbers with the Linear Congruential Generator</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">GetRandomLinearCongruential</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">long</span> seed = <span class="number">100</span>;</div><div class="line"></div><div class="line">	<span class="comment">//Needs the following parameters, which can be found on Wikipedia for different implementations</span></div><div class="line">	<span class="comment">//https://en.wikipedia.org/wiki/Linear_congruential_generator</span></div><div class="line">	<span class="comment">//multiplier</span></div><div class="line">	<span class="keyword">long</span> a = <span class="number">1103515245</span>;</div><div class="line">	<span class="comment">//increment</span></div><div class="line">	<span class="keyword">long</span> c = <span class="number">12345</span>;</div><div class="line">	<span class="comment">//modulus m (which is also the maximum possible random value)</span></div><div class="line">	<span class="keyword">long</span> m = (<span class="keyword">long</span>)Mathf.Pow(<span class="number">2</span>f, <span class="number">31</span>f);</div><div class="line"></div><div class="line">	<span class="comment">//To display the random numbers when the loop is finished</span></div><div class="line">	<span class="keyword">string</span> allRandomNumbers = <span class="string">""</span>;</div><div class="line"></div><div class="line">	<span class="comment">//How many random numbers do we want to generate?</span></div><div class="line">	<span class="keyword">int</span> amountOfNumbers = <span class="number">30000</span>;</div><div class="line"></div><div class="line">	<span class="comment">//Array that will store the random numbers so we can display them</span></div><div class="line">	<span class="keyword">float</span>[] randomNumbers = <span class="keyword">new</span> <span class="keyword">float</span>[amountOfNumbers];</div><div class="line"></div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; amountOfNumbers; i++)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">//Basic idea: seed = (a * seed + c) mod m</span></div><div class="line">		seed = (a * seed + c) % m;</div><div class="line">		</div><div class="line">		<span class="comment">//To get a value between 0 and 1</span></div><div class="line">		<span class="keyword">float</span> randomValue = seed / (<span class="keyword">float</span>)m;</div><div class="line"></div><div class="line">		<span class="comment">//Remove this line if you want to speed up the testing of the algorithm</span></div><div class="line">		allRandomNumbers += randomValue + <span class="string">" "</span>;</div><div class="line"></div><div class="line">		randomNumbers[i] = randomValue;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	print(allRandomNumbers);</div><div class="line"></div><div class="line">	DrawRandomMap(randomNumbers);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>And this is the result after 30000 iterations:</p>
<p><img src="https://raw.githubusercontent.com/tospan/tospan.github.io/source/source/_images/unity/random-numbers-linear-congruential-generator.png" alt="Visualization of random numbers with the Linear Congruential Generator"><br>The Linear Congruential Generator will begin to repeat itself with some parameters, but the repetition is not as obvious as in the Middle Square Method where we got all black.</p>
<h2 id="2-Generate-random-numbers-with-shader-code"><a href="#2-Generate-random-numbers-with-shader-code" class="headerlink" title="2. Generate random numbers with shader code"></a>2. Generate random numbers with shader code</h2><p>The idea behind this article was to learn how to generate random numbers in a shader. If you read the first part of the tutorial you might understand why we can’t use the normal way to generate random nnumbers in a shader. Yes, you can add the Linear Congruential Generator to the shader, give it a seed, and it will generate random numbers. The problem is that it is not possible to save the latest seed somewhere. So if you generate a random value for each vertex, the random values will be the same for each vertex, because there’s no way to save the latest seed between the vertices.</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://www.habrador.com/tutorials/generate-random-numbers/2-generate-random-numbers-shaders/" target="_blank" rel="external">How to generate random numbers in Unity with C# and shader code</a></li>
<li><a href="http://www.codeproject.com/Articles/28548/Pitfalls-in-Random-Number-Generation" target="_blank" rel="external">Code Project - Pitfalls in Random Number Generation</a></li>
<li><a href="http://openfortress.org/cryptodoc/random/" target="_blank" rel="external">OpenFortress - How To Generate Truly Random Bits</a></li>
<li><a href="https://www.amazon.com/Essential-Mathematics-Games-Interactive-Applications/dp/0123742978" target="_blank" rel="external">Essential Mathematics for Games and Interactive Applications</a></li>
<li><a href="https://www.random.org/randomness/" target="_blank" rel="external">Random.org - Introduction to Randomness and Random Numbers</a></li>
<li><a href="https://www.youtube.com/watch?v=4sYawx70iP4" target="_blank" rel="external">Coding Math - Pseudo Random Number Generators</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tospan.me/2017/02/05/Generate-random-numbers/" data-id="cizcq856z002etdvw594ds9e6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Algorithms/">Algorithms</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity/">Unity</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/02/05/Unity-Make-a-realistic-bullets/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Unity Make a realistic bullets
        
      </div>
    </a>
  
  
    <a href="/2017/02/05/Interpolation-in-Unity/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Everything about interpolation in Unity with C#</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithms/">Algorithms</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Game-Development/">Game Development</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity/">Unity</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/default/">default</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithms/">Algorithms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Basics/">Basics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Games/">Games</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Geometry/">Geometry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linear-Algebra/">Linear Algebra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/">Math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mathematics/">Mathematics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Numerical-Analysis/">Numerical Analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Patterns/">Patterns</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scripting/">Scripting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/">Unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/default/">default</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algorithms/" style="font-size: 10px;">Algorithms</a> <a href="/tags/Basics/" style="font-size: 15px;">Basics</a> <a href="/tags/C/" style="font-size: 13.33px;">C#</a> <a href="/tags/Games/" style="font-size: 10px;">Games</a> <a href="/tags/Geometry/" style="font-size: 11.67px;">Geometry</a> <a href="/tags/Linear-Algebra/" style="font-size: 16.67px;">Linear Algebra</a> <a href="/tags/Math/" style="font-size: 15px;">Math</a> <a href="/tags/Mathematics/" style="font-size: 15px;">Mathematics</a> <a href="/tags/Numerical-Analysis/" style="font-size: 10px;">Numerical Analysis</a> <a href="/tags/Patterns/" style="font-size: 10px;">Patterns</a> <a href="/tags/Scripting/" style="font-size: 13.33px;">Scripting</a> <a href="/tags/Unity/" style="font-size: 20px;">Unity</a> <a href="/tags/default/" style="font-size: 18.33px;">default</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/02/16/Algorithms-Data-Structure/">算法:数据结构</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms-Sorting/">算法：排序</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms-Test-Bed/">搭建算法测试环境</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms-Basics/">Algorithms Basics</a>
          </li>
        
          <li>
            <a href="/2017/02/16/Algorithms/">Algorithms</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 To Span<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>